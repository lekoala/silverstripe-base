"use strict";(()=>{var le=Object.create;var Rt=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var ue=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(i,e)=>(typeof require<"u"?require:i)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var pe=(t,i,e,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of de(i))!fe.call(t,s)&&s!==e&&Rt(t,s,{get:()=>i[s],enumerable:!(n=ce(i,s))||n.enumerable});return t};var me=(t,i,e)=>(e=t!=null?le(he(t)):{},pe(i||!t||!t.__esModule?Rt(e,"default",{value:t,enumerable:!0}):e,t));var Vt=1,Q=4,K=5,ve=()=>!0,A=class{root;currentNode;nodeType;filter;constructor(t,i,e){this.root=t,this.currentNode=t,this.nodeType=i,this.filter=e||ve}isAcceptableNode(t){let i=t.nodeType;return!!((i===Node.ELEMENT_NODE?Vt:i===Node.TEXT_NODE?Q:0)&this.nodeType)&&this.filter(t)}nextNode(){let t=this.root,i=this.currentNode,e;for(;;){for(e=i.firstChild;!e&&i&&i!==t;)e=i.nextSibling,e||(i=i.parentNode);if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;i=e}}previousNode(){let t=this.root,i=this.currentNode,e;for(;;){if(i===t)return null;if(e=i.previousSibling,e)for(;i=e.lastChild;)e=i;else e=i.parentNode;if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;i=e}}previousPONode(){let t=this.root,i=this.currentNode,e;for(;;){for(e=i.lastChild;!e&&i&&i!==t;)e=i.previousSibling,e||(i=i.parentNode);if(!e)return null;if(this.isAcceptableNode(e))return this.currentNode=e,e;i=e}}},Se=1,Wt=3,Ce=11,Y="\u200B",$=navigator.userAgent,xt=/Mac OS X/.test($),qt=/Windows NT/.test($),Kt=/iP(?:ad|hone|od)/.test($)||xt&&!!navigator.maxTouchPoints,Ne=/Android/.test($),ge=/Gecko\//.test($),rt=/Edge\//.test($),_e=!rt&&/WebKit\//.test($),E=xt||Kt?"Meta-":"Ctrl-",St=_e,we="onbeforeinput"in document&&"inputType"in new InputEvent("input"),P=/[^ \t\r\n]/,xe=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,Te=new Set(["BR","HR","IFRAME","IMG","INPUT"]),be=0,Ct=1,Zt=2,$t=3,ot=new WeakMap,ke=()=>{ot=new WeakMap},V=t=>Te.has(t.nodeName),Tt=t=>{switch(t.nodeType){case Wt:return Ct;case Se:case Ce:if(ot.has(t))return ot.get(t);break;default:return be}let i;return Array.from(t.childNodes).every(v)?xe.test(t.nodeName)?i=Ct:i=Zt:i=$t,ot.set(t,i),i},v=t=>Tt(t)===Ct,H=t=>Tt(t)===Zt,J=t=>Tt(t)===$t,p=(t,i,e)=>{let n=document.createElement(t);if(i instanceof Array&&(e=i,i=null),i)for(let s in i){let o=i[s];o!==void 0&&n.setAttribute(s,o)}return e&&e.forEach(s=>n.appendChild(s)),n},Gt=(t,i)=>V(t)||t.nodeType!==i.nodeType||t.nodeName!==i.nodeName?!1:t instanceof HTMLElement&&i instanceof HTMLElement?t.nodeName!=="A"&&t.className===i.className&&t.style.cssText===i.style.cssText:!0,Nt=(t,i,e)=>{if(t.nodeName!==i)return!1;for(let n in e)if(!("getAttribute"in t)||t.getAttribute(n)!==e[n])return!1;return!0},S=(t,i,e,n)=>{for(;t&&t!==i;){if(Nt(t,e,n))return t;t=t.parentNode}return null},bt=(t,i)=>{let e=t.childNodes;for(;i&&t instanceof Element;)t=e[i-1],e=t.childNodes,i=e.length;return t},jt=(t,i)=>{let e=t;if(e instanceof Element){let n=e.childNodes;if(i<n.length)e=n[i];else{for(;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)}}return e},y=t=>t instanceof Element||t instanceof DocumentFragment?t.childNodes.length:t instanceof CharacterData?t.length:0,C=t=>{let i=document.createDocumentFragment(),e=t.firstChild;for(;e;)i.appendChild(e),e=t.firstChild;return i},x=t=>{let i=t.parentNode;return i&&i.removeChild(t),t},b=(t,i)=>{let e=t.parentNode;e&&e.replaceChild(i,t)},Ee=t=>t instanceof Element?t.nodeName==="BR":P.test(t.data),ct=(t,i)=>{let e=t.parentNode;for(;v(e);)e=e.parentNode;let n=new A(e,K,Ee);return n.currentNode=t,!!n.nextNode()||i&&!n.previousNode()},mt=(t,i)=>{let e=new A(t,Q),n,s;for(;n=e.nextNode();)for(;(s=n.data.indexOf(Y))>-1&&(!i||n.parentNode!==i);)if(n.length===1){let o=n,r=o.parentNode;for(;r&&(r.removeChild(o),e.currentNode=r,!(!v(r)||y(r)));)o=r,r=o.parentNode;break}else n.deleteData(s,1)},Le=0,Ae=1,Oe=2,ye=3,M=(t,i,e)=>{let n=document.createRange();if(n.selectNode(i),e){let s=t.compareBoundaryPoints(ye,n)>-1,o=t.compareBoundaryPoints(Ae,n)<1;return!s&&!o}else{let s=t.compareBoundaryPoints(Le,n)<1,o=t.compareBoundaryPoints(Oe,n)>-1;return s&&o}},T=t=>{let{startContainer:i,startOffset:e,endContainer:n,endOffset:s}=t;for(;!(i instanceof Text);){let o=i.childNodes[e];if(!o||V(o)){if(e&&(o=i.childNodes[e-1],o instanceof Text)){let r=o,a;for(;!r.length&&(a=r.previousSibling)&&a instanceof Text;)r.remove(),r=a;i=r,e=r.data.length}break}i=o,e=0}if(s)for(;!(n instanceof Text);){let o=n.childNodes[s-1];if(!o||V(o)){if(o&&o.nodeName==="BR"&&!ct(o,!1)){s-=1;continue}break}n=o,s=y(n)}else for(;!(n instanceof Text);){let o=n.firstChild;if(!o||V(o))break;n=o}t.setStart(i,e),t.setEnd(n,s)},W=(t,i,e,n)=>{let s=t.startContainer,o=t.startOffset,r=t.endContainer,a=t.endOffset,l;for(i||(i=t.commonAncestorContainer),e||(e=i);!o&&s!==i&&s!==n;)l=s.parentNode,o=Array.from(l.childNodes).indexOf(s),s=l;for(;!(r===e||r===n||(r.nodeType!==Wt&&r.childNodes[a]&&r.childNodes[a].nodeName==="BR"&&!ct(r.childNodes[a],!1)&&(a+=1),a!==y(r)));)l=r.parentNode,a=Array.from(l.childNodes).indexOf(r)+1,r=l;t.setStart(s,o),t.setEnd(r,a)},It=(t,i,e)=>{let n=S(t.endContainer,e,i);if(n&&(n=n.parentNode)){let s=t.cloneRange();W(s,n,n,e),s.endContainer===n&&(t.setStart(s.endContainer,s.endOffset),t.setEnd(s.endContainer,s.endOffset))}return t},_=t=>{let i=null;if(t instanceof Text)return t;if(v(t)){let e=t.firstChild;if(St)for(;e&&e instanceof Text&&!e.data;)t.removeChild(e),e=t.firstChild;e||(St?i=document.createTextNode(Y):i=document.createTextNode(""))}else if(t instanceof Element&&!t.querySelector("BR")){i=p("BR");let e=t,n;for(;(n=e.lastElementChild)&&!v(n);)e=n}if(i)try{t.appendChild(i)}catch{}return t},D=(t,i)=>{let e=null;return Array.from(t.childNodes).forEach(n=>{let s=n.nodeName==="BR";!s&&v(n)?(e||(e=p("DIV")),e.appendChild(n)):(s||e)&&(e||(e=p("DIV")),_(e),s?t.replaceChild(e,n):t.insertBefore(e,n),e=null),J(n)&&D(n,i)}),e&&t.appendChild(_(e)),t},O=(t,i,e,n)=>{if(t instanceof Text&&t!==e){if(typeof i!="number")throw new Error("Offset must be a number to split text node!");if(!t.parentNode)throw new Error("Cannot split text node with no parent!");return O(t.parentNode,t.splitText(i),e,n)}let s=typeof i=="number"?i<t.childNodes.length?t.childNodes[i]:null:i,o=t.parentNode;if(!o||t===e||!(t instanceof Element))return s;let r=t.cloneNode(!1);for(;s;){let a=s.nextSibling;r.appendChild(s),s=a}return t instanceof HTMLOListElement&&S(t,n,"BLOCKQUOTE")&&(r.start=(+t.start||1)+t.childNodes.length-1),_(t),_(r),o.insertBefore(r,t.nextSibling),O(o,r,e,n)},Qt=(t,i)=>{let e=t.childNodes,n=e.length,s=[];for(;n--;){let o=e[n],r=n?e[n-1]:null;if(r&&v(o)&&Gt(o,r))i.startContainer===o&&(i.startContainer=r,i.startOffset+=y(r)),i.endContainer===o&&(i.endContainer=r,i.endOffset+=y(r)),i.startContainer===t&&(i.startOffset>n?i.startOffset-=1:i.startOffset===n&&(i.startContainer=r,i.startOffset=y(r))),i.endContainer===t&&(i.endOffset>n?i.endOffset-=1:i.endOffset===n&&(i.endContainer=r,i.endOffset=y(r))),x(o),o instanceof Text?r.appendData(o.data):s.push(C(o));else if(o instanceof Element){let a;for(;a=s.pop();)o.appendChild(a);Qt(o,i)}}},j=(t,i)=>{let e=t instanceof Text?t.parentNode:t;if(e instanceof Element){let n={startContainer:i.startContainer,startOffset:i.startOffset,endContainer:i.endContainer,endOffset:i.endOffset};Qt(e,n),i.setStart(n.startContainer,n.startOffset),i.setEnd(n.endContainer,n.endOffset)}},it=(t,i,e,n)=>{let s=i,o,r;for(;(o=s.parentNode)&&o!==n&&o instanceof Element&&o.childNodes.length===1;)s=o;x(s),r=t.childNodes.length;let a=t.lastChild;a&&a.nodeName==="BR"&&(t.removeChild(a),r-=1),t.appendChild(C(i)),e.setStart(t,r),e.collapse(!0),j(t,e)},F=(t,i)=>{let e=t.previousSibling,n=t.firstChild,s=t.nodeName==="LI";if(!(s&&(!n||!/^[OU]L$/.test(n.nodeName)))){if(e&&Gt(e,t)){if(!J(e))if(s){let r=p("DIV");r.appendChild(C(e)),e.appendChild(r)}else return;x(t);let o=!J(t);e.appendChild(C(t)),o&&D(e,i),n&&F(n,i)}else if(s){let o=p("DIV");t.insertBefore(o,n),_(o)}}},Pt={"font-weight":{regexp:/^bold|^700/i,replace(){return p("B")}},"font-style":{regexp:/^italic/i,replace(){return p("I")}},"font-family":{regexp:P,replace(t,i){return p("SPAN",{class:t.fontFamily,style:"font-family:"+i})}},"font-size":{regexp:P,replace(t,i){return p("SPAN",{class:t.fontSize,style:"font-size:"+i})}},"text-decoration":{regexp:/^underline/i,replace(){return p("U")}}},Be=(t,i,e)=>{let n=t.style,s,o;for(let r in Pt){let a=Pt[r],l=n.getPropertyValue(r);if(l&&a.regexp.test(l)){let c=a.replace(e.classNames,l);if(c.nodeName===t.nodeName&&c.className===t.className)continue;o||(o=c),s&&s.appendChild(c),s=c,t.style.removeProperty(r)}}return o&&s&&(s.appendChild(C(t)),t.style.cssText?t.appendChild(o):b(t,o)),s||t},st=t=>(i,e)=>{let n=p(t),s=i.attributes;for(let o=0,r=s.length;o<r;o+=1){let a=s[o];n.setAttribute(a.name,a.value)}return e.replaceChild(n,i),n.appendChild(C(i)),n},De={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},Re={STRONG:st("B"),EM:st("I"),INS:st("U"),STRIKE:st("S"),SPAN:Be,FONT:(t,i,e)=>{let n=t,s=n.face,o=n.size,r=n.color,a=e.classNames,l,c,d,h,f;return s&&(l=p("SPAN",{class:a.fontFamily,style:"font-family:"+s}),f=l,h=l),o&&(c=p("SPAN",{class:a.fontSize,style:"font-size:"+De[o]+"px"}),f||(f=c),h&&h.appendChild(c),h=c),r&&/^#?([\dA-F]{3}){1,2}$/i.test(r)&&(r.charAt(0)!=="#"&&(r="#"+r),d=p("SPAN",{class:a.color,style:"color:"+r}),f||(f=d),h&&h.appendChild(d),h=d),(!f||!h)&&(f=h=p("SPAN")),i.replaceChild(f,n),h.appendChild(C(n)),h},TT:(t,i,e)=>{let n=p("SPAN",{class:e.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return i.replaceChild(n,t),n.appendChild(C(t)),n}},Ie=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,Pe=/^(?:HEAD|META|STYLE)/,gt=(t,i,e)=>{let n=t.childNodes,s=t;for(;v(s);)s=s.parentNode;let o=new A(s,K);for(let r=0,a=n.length;r<a;r+=1){let l=n[r],c=l.nodeName,d=Re[c];if(l instanceof HTMLElement){let h=l.childNodes.length;if(d)l=d(l,t,i);else if(Pe.test(c)){t.removeChild(l),r-=1,a-=1;continue}else if(!Ie.test(c)&&!v(l)){r-=1,a+=h-1,t.replaceChild(C(l),l);continue}h&&gt(l,i,e||c==="PRE")}else{if(l instanceof Text){let h=l.data,f=!P.test(h.charAt(0)),u=!P.test(h.charAt(h.length-1));if(e||!f&&!u)continue;if(f){o.currentNode=l;let m;for(;(m=o.previousPONode())&&!(m.nodeName==="IMG"||m instanceof Text&&P.test(m.data));)if(!v(m)){m=null;break}h=h.replace(/^[ \t\r\n]+/g,m?" ":"")}if(u){o.currentNode=l;let m;for(;(m=o.nextNode())&&!(m.nodeName==="IMG"||m instanceof Text&&P.test(m.data));)if(!v(m)){m=null;break}h=h.replace(/[ \t\r\n]+$/g,m?" ":"")}if(h){l.data=h;continue}}t.removeChild(l),r-=1,a-=1}}return t},_t=t=>{let i=t.childNodes,e=i.length;for(;e--;){let n=i[e];n instanceof Element&&!V(n)?(_t(n),v(n)&&!n.firstChild&&t.removeChild(n)):n instanceof Text&&!n.data&&t.removeChild(n)}},at=(t,i,e)=>{let n=t.querySelectorAll("BR"),s=[],o=n.length;for(let r=0;r<o;r+=1)s[r]=ct(n[r],e);for(;o--;){let r=n[o],a=r.parentNode;a&&(s[o]?v(a)||D(a,i):x(r))}},Ft=t=>t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;"),lt=(t,i)=>{let e=new A(i,Vt,H);return e.currentNode=t,e},X=(t,i)=>{let e=lt(t,i).previousNode();return e!==i?e:null},z=(t,i)=>{let e=lt(t,i).nextNode();return e!==i?e:null},wt=t=>!t.textContent&&!t.querySelector("IMG"),B=(t,i)=>{let e=t.startContainer,n;if(v(e))n=X(e,i);else if(e!==i&&e instanceof HTMLElement&&H(e))n=e;else{let s=bt(e,t.startOffset);n=z(s,i)}return n&&M(t,n,!0)?n:null},Z=(t,i)=>{let e=t.endContainer,n;if(v(e))n=X(e,i);else if(e!==i&&e instanceof HTMLElement&&H(e))n=e;else{let s=jt(e,t.endOffset);if(!s||!i.contains(s)){s=i;let o;for(;o=s.lastChild;)s=o}n=X(s,i)}return n&&M(t,n,!0)?n:null},Yt=t=>t instanceof Text?P.test(t.data):t.nodeName==="IMG",nt=(t,i)=>{let e=t.startContainer,n=t.startOffset,s;if(e instanceof Text){if(n)return!1;s=e}else if(s=jt(e,n),s&&!i.contains(s)&&(s=null),!s&&(s=bt(e,n),s instanceof Text&&s.length))return!1;let o=B(t,i);if(!o)return!1;let r=new A(o,K,Yt);return r.currentNode=s,!r.previousNode()},dt=(t,i)=>{let e=t.endContainer,n=t.endOffset,s;if(e instanceof Text){let a=e.data.length;if(a&&n<a)return!1;s=e}else s=bt(e,n);let o=Z(t,i);if(!o)return!1;let r=new A(o,K,Yt);return r.currentNode=s,!r.nextNode()},Ut=(t,i)=>{let e=B(t,i),n=Z(t,i),s;e&&n&&(s=e.parentNode,t.setStart(s,Array.from(s.childNodes).indexOf(e)),s=n.parentNode,t.setEnd(s,Array.from(s.childNodes).indexOf(n)+1))};function q(t,i,e,n){let s=document.createRange();return s.setStart(t,i),e&&typeof n=="number"?s.setEnd(e,n):s.setEnd(t,i),s}var I=(t,i)=>{let{startContainer:e,startOffset:n,endContainer:s,endOffset:o}=t,r;if(e instanceof Text){let l=e.parentNode;if(r=l.childNodes,n===e.length)n=Array.from(r).indexOf(e)+1,t.collapsed&&(s=l,o=n);else{if(n){let c=e.splitText(n);s===e?(o-=n,s=c):s===l&&(o+=1),e=c}n=Array.from(r).indexOf(e)}e=l}else r=e.childNodes;let a=r.length;n===a?e.appendChild(i):e.insertBefore(i,r[n]),e===s&&(o+=r.length-a),t.setStart(e,n),t.setEnd(s,o)},Jt=(t,i,e)=>{let n=document.createDocumentFragment();if(t.collapsed)return n;i||(i=t.commonAncestorContainer),i instanceof Text&&(i=i.parentNode);let s=t.startContainer,o=t.startOffset,r=O(t.endContainer,t.endOffset,i,e),a=0,l=O(s,o,i,e);for(;l&&l!==r;){let c=l.nextSibling;n.appendChild(l),l=c}return s instanceof Text&&r instanceof Text&&(s.appendData(r.data),x(r),r=s,a=o),t.setStart(s,o),r?t.setEnd(r,a):t.setEnd(i,i.childNodes.length),_(i),n},Mt=(t,i,e)=>{t.currentNode=e;let n;for(;n=t[i]();){if(n instanceof Text||V(n))return n;if(!v(n))return null}return null},G=(t,i)=>{let e=B(t,i),n=Z(t,i),s=e!==n;e&&n&&(T(t),W(t,e,n,i));let o=Jt(t,null,i);T(t),s&&(n=Z(t,i),e&&n&&e!==n&&it(e,n,t,i)),e&&_(e);let r=i.firstChild;(!r||r.nodeName==="BR")&&(_(i),i.firstChild&&t.selectNodeContents(i.firstChild)),t.collapse(!0);let a=t.startContainer,l=t.startOffset,c=new A(i,K),d=a,h=l;(!(d instanceof Text)||h===d.data.length)&&(d=Mt(c,"nextNode",d),h=0);let f=a,u=l-1;(!(f instanceof Text)||u===-1)&&(f=Mt(c,"previousPONode",d||(a instanceof Text?a:a.childNodes[l]||a)),f instanceof Text&&(u=f.data.length));let m=null,N=0;return d instanceof Text&&d.data.charAt(h)===" "&&nt(t,i)?(m=d,N=h):f instanceof Text&&f.data.charAt(u)===" "&&(d instanceof Text&&d.data.charAt(h)===" "||dt(t,i))&&(m=f,N=u),m&&m.replaceData(N,1,"\xA0"),t.setStart(a,l),t.collapse(!0),o},Fe=(t,i,e)=>{let n=i.firstChild&&v(i.firstChild),s;for(D(i,e),s=i;s=z(s,e);)_(s);t.collapsed||G(t,e),T(t),t.collapse(!1);let o=S(t.endContainer,e,"BLOCKQUOTE")||e,r=B(t,e),a=null,l=z(i,i),c=!n&&!!r&&wt(r);if(r&&l&&!c&&!S(l,i,"PRE")&&!S(l,i,"TABLE")){W(t,r,r,e),t.collapse(!0);let d=t.endContainer,h=t.endOffset;if(at(r,e,!1),v(d)){let f=O(d,h,X(d,e)||e,e);d=f.parentNode,h=Array.from(d.childNodes).indexOf(f)}if(h!==y(d))for(a=document.createDocumentFragment();s=d.childNodes[h];)a.appendChild(s);it(d,l,t,e),h=Array.from(d.parentNode.childNodes).indexOf(d)+1,d=d.parentNode,t.setEnd(d,h)}if(y(i)){c&&r&&(t.setEndBefore(r),t.collapse(!1),x(r)),W(t,o,o,e);let d=O(t.endContainer,t.endOffset,o,e),h=d?d.previousSibling:o.lastChild;o.insertBefore(i,d),d?t.setEndBefore(d):t.setEnd(o,y(o)),r=Z(t,e),T(t);let f=t.endContainer,u=t.endOffset;d&&J(d)&&F(d,e),d=h&&h.nextSibling,d&&J(d)&&F(d,e),t.setEnd(f,u)}if(a&&r){let d=t.cloneRange();it(r,a,d,e),t.setEnd(d.endContainer,d.endOffset)}T(t)},vt=Array.prototype.indexOf,Ue=(t,i,e,n,s,o)=>{let r=t.clipboardData,a=document.body,l=p("DIV"),c,d;i.childNodes.length===1&&i.childNodes[0]instanceof Text?(d=i.childNodes[0].data.replace(/ /g," "),o=!0):(l.appendChild(i),c=l.innerHTML,n&&(c=n(c))),d!==void 0||(s&&c!==void 0?d=s(c):(at(l,e,!0),l.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),a.appendChild(l),d=l.innerText||l.textContent,d=d.replace(/ /g," "),a.removeChild(l))),qt&&(d=d.replace(/\r?\n/g,`\r
`)),!o&&c&&d!==c&&r.setData("text/html",c),r.setData("text/plain",d),t.preventDefault()},Xt=(t,i,e,n,s,o,r)=>{if(!rt&&t.clipboardData){let a=B(i,e),l=Z(i,e),c=e;a===l&&a?.contains(i.commonAncestorContainer)&&(c=a);let d;n?d=G(i,e):(i=i.cloneRange(),T(i),W(i,c,c,e),d=i.cloneContents());let h=i.commonAncestorContainer;for(h instanceof Text&&(h=h.parentNode);h&&h!==c;){let f=h.cloneNode(!1);f.appendChild(d),d=f,h=h.parentNode}return Ue(t,d,e,s,o,r),!0}return!1},Me=function(t){let i=this.getSelection(),e=this._root;if(i.collapsed){t.preventDefault();return}this.saveUndoState(i),Xt(t,i,e,!0,this._config.willCutCopy,null,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(s){this._config.didError(s)}},0),this.setSelection(i)},He=function(t){Xt(t,this.getSelection(),this._root,!1,this._config.willCutCopy,null,!1)},Ht=function(t){this._isShiftDown=t.shiftKey},ze=function(t){let i=t.clipboardData,e=i?.items,n=this._isShiftDown,s=!1,o=!1,r=null,a=null;if(e){let w=e.length;for(;w--;){let L=e[w],k=L.type;k==="text/html"?a=L:k==="text/plain"||k==="text/uri-list"?r=L:k==="text/rtf"?s=!0:/^image\/.*/.test(k)&&(o=!0)}if(o&&!(s&&a)){t.preventDefault(),this.fireEvent("pasteImage",{clipboardData:i});return}if(!rt){t.preventDefault(),a&&(!n||!r)?a.getAsString(L=>{this.insertHTML(L,!0)}):r&&r.getAsString(L=>{let k=!1,Bt=this.getSelection();if(!Bt.collapsed&&P.test(Bt.toString())){let Dt=this.linkRegExp.exec(L);k=!!Dt&&Dt[0].length===L.length}k?this.makeLink(L):this.insertPlainText(L,!0)});return}}let l=i?.types;if(!rt&&l&&(vt.call(l,"text/html")>-1||!ge&&vt.call(l,"text/plain")>-1&&vt.call(l,"text/rtf")<0)){t.preventDefault();let w;!n&&(w=i.getData("text/html"))?this.insertHTML(w,!0):((w=i.getData("text/plain"))||(w=i.getData("text/uri-list")))&&this.insertPlainText(w,!0);return}let c=document.body,d=this.getSelection(),h=d.startContainer,f=d.startOffset,u=d.endContainer,m=d.endOffset,N=p("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});c.appendChild(N),d.selectNodeContents(N),this.setSelection(d),setTimeout(()=>{try{let w="",L=N,k;for(;N=L;)L=N.nextSibling,x(N),k=N.firstChild,k&&k===N.lastChild&&k instanceof HTMLDivElement&&(N=k),w+=N.innerHTML;this.setSelection(q(h,f,u,m)),w&&this.insertHTML(w,!0)}catch(w){this._config.didError(w)}},0)},Ve=function(t){if(!t.dataTransfer)return;let i=t.dataTransfer.types,e=i.length,n=!1,s=!1;for(;e--;)switch(i[e]){case"text/plain":n=!0;break;case"text/html":s=!0;break;default:return}(s||n&&this.saveUndoState)&&this.saveUndoState()},zt=(t,i,e)=>{i.preventDefault(),t.splitBlock(i.shiftKey,e)},et=(t,i)=>{try{i||(i=t.getSelection());let e=i.startContainer;e instanceof Text&&(e=e.parentNode);let n=e;for(;v(n)&&(!n.textContent||n.textContent===Y);)e=n,n=e.parentNode;e!==n&&(i.setStart(n,Array.from(n.childNodes).indexOf(e)),i.collapse(!0),n.removeChild(e),H(n)||(n=X(n,t._root)||t._root),_(n),T(i)),e===t._root&&(e=e.firstChild)&&e.nodeName==="BR"&&x(e),t._ensureBottomLine(),t.setSelection(i),t._updatePath(i,!0)}catch(e){t._config.didError(e)}},te=(t,i)=>{let e;for(;(e=t.parentNode)&&!(e===i||e.isContentEditable);)t=e;x(t)},ee=(t,i,e)=>{if(S(i,t._root,"A"))return;let n=i.data||"",s=Math.max(n.lastIndexOf(" ",e-1),n.lastIndexOf("\xA0",e-1))+1,o=n.slice(s,e),r=t.linkRegExp.exec(o);if(r){let a=t.getSelection();t._docWasChanged(),t._recordUndoState(a),t._getRangeAndRemoveBookmark(a);let l=s+r.index,c=l+r[0].length,d=a.startContainer===i,h=a.startOffset-c;l&&(i=i.splitText(l));let f=t._config.tagAttributes.a,u=p("A",Object.assign({href:r[1]?/^(?:ht|f)tps?:/i.test(r[1])?r[1]:"http://"+r[1]:"mailto:"+r[0]},f));u.textContent=n.slice(l,c),i.parentNode.insertBefore(u,i),i.data=n.slice(c),d&&(a.setStart(i,h),a.setEnd(i,h)),t.setSelection(a)}},We=(t,i,e)=>{let n=t._root;if(t._removeZWS(),t.saveUndoState(e),!e.collapsed)i.preventDefault(),G(e,n),et(t,e);else if(nt(e,n)){i.preventDefault();let s=B(e,n);if(!s)return;let o=s;D(o.parentNode,n);let r=X(o,n);if(r){if(!r.isContentEditable){te(r,n);return}for(it(r,o,e,n),o=r.parentNode;o!==n&&!o.nextSibling;)o=o.parentNode;o!==n&&(o=o.nextSibling)&&F(o,n),t.setSelection(e)}else if(o){if(S(o,n,"UL")||S(o,n,"OL")){t.decreaseListLevel(e);return}else if(S(o,n,"BLOCKQUOTE")){t.removeQuote(e);return}t.setSelection(e),t._updatePath(e,!0)}}else{T(e);let s=e.startContainer,o=e.startOffset,r=s.parentNode;s instanceof Text&&r instanceof HTMLAnchorElement&&o&&r.href.includes(s.data)?(s.deleteData(o-1,1),t.setSelection(e),t.removeLink(),i.preventDefault()):(t.setSelection(e),setTimeout(()=>{et(t)},0))}},qe=(t,i,e)=>{let n=t._root,s,o,r,a,l,c;if(t._removeZWS(),t.saveUndoState(e),!e.collapsed)i.preventDefault(),G(e,n),et(t,e);else if(dt(e,n)){if(i.preventDefault(),s=B(e,n),!s)return;if(D(s.parentNode,n),o=z(s,n),o){if(!o.isContentEditable){te(o,n);return}for(it(s,o,e,n),o=s.parentNode;o!==n&&!o.nextSibling;)o=o.parentNode;o!==n&&(o=o.nextSibling)&&F(o,n),t.setSelection(e),t._updatePath(e,!0)}}else{if(r=e.cloneRange(),W(e,n,n,n),a=e.endContainer,l=e.endOffset,a instanceof Element&&(c=a.childNodes[l],c&&c.nodeName==="IMG")){i.preventDefault(),x(c),T(e),et(t,e);return}t.setSelection(r),setTimeout(()=>{et(t)},0)}},Ke=(t,i,e)=>{let n=t._root;if(t._removeZWS(),e.collapsed&&nt(e,n)){let s=B(e,n),o;for(;o=s.parentNode;){if(o.nodeName==="UL"||o.nodeName==="OL"){i.preventDefault(),t.increaseListLevel(e);break}s=o}}},Ze=(t,i,e)=>{let n=t._root;if(t._removeZWS(),e.collapsed&&nt(e,n)){let s=e.startContainer;(S(s,n,"UL")||S(s,n,"OL"))&&(i.preventDefault(),t.decreaseListLevel(e))}},$e=(t,i,e)=>{let n,s=t._root;if(t._recordUndoState(e),t._getRangeAndRemoveBookmark(e),e.collapsed||(G(e,s),t._ensureBottomLine(),t.setSelection(e),t._updatePath(e,!0)),n=e.endContainer,e.endOffset===y(n))do if(n.nodeName==="A"){e.setStartAfter(n);break}while(!n.nextSibling&&(n=n.parentNode)&&n!==s);if(t._config.addLinks){let o=e.cloneRange();T(o);let r=o.startContainer,a=o.startOffset;setTimeout(()=>{ee(t,r,a)},0)}t.setSelection(e)},Ge={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",191:"/",219:"[",220:"\\",221:"]"},je=function(t){let i=t.keyCode,e=Ge[i],n="",s=this.getSelection();t.defaultPrevented||(e||(e=String.fromCharCode(i).toLowerCase(),/^[A-Za-z0-9]$/.test(e)||(e="")),111<i&&i<124&&(e="F"+(i-111)),e!=="Backspace"&&e!=="Delete"&&(t.altKey&&(n+="Alt-"),t.ctrlKey&&(n+="Ctrl-"),t.metaKey&&(n+="Meta-"),t.shiftKey&&(n+="Shift-")),qt&&t.shiftKey&&e==="Delete"&&(n+="Shift-"),e=n+e,this._keyHandlers[e]?this._keyHandlers[e](this,t,s):!s.collapsed&&!t.isComposing&&!t.ctrlKey&&!t.metaKey&&(t.key||e).length===1&&(this.saveUndoState(s),G(s,this._root),this._ensureBottomLine(),this.setSelection(s),this._updatePath(s,!0)))},g={Backspace:We,Delete:qe,Tab:Ke,"Shift-Tab":Ze,Space:$e,ArrowLeft(t){t._removeZWS()},ArrowRight(t,i,e){t._removeZWS();let n=t.getRoot();if(dt(e,n)){T(e);let s=e.endContainer;do if(s.nodeName==="CODE"){let o=s.nextSibling;if(!(o instanceof Text)){let r=document.createTextNode("\xA0");s.parentNode.insertBefore(r,o),o=r}e.setStart(o,1),t.setSelection(e),i.preventDefault();break}while(!s.nextSibling&&(s=s.parentNode)&&s!==n)}}};we||(g.Enter=zt,g["Shift-Enter"]=zt);!xt&&!Kt&&(g.PageUp=t=>{t.moveCursorToStart()},g.PageDown=t=>{t.moveCursorToEnd()});var tt=(t,i)=>(i=i||null,(e,n)=>{n.preventDefault();let s=e.getSelection();e.hasFormat(t,null,s)?e.changeFormat(null,{tag:t},s):e.changeFormat({tag:t},i,s)});g[E+"b"]=tt("B");g[E+"i"]=tt("I");g[E+"u"]=tt("U");g[E+"Shift-7"]=tt("S");g[E+"Shift-5"]=tt("SUB",{tag:"SUP"});g[E+"Shift-6"]=tt("SUP",{tag:"SUB"});g[E+"Shift-8"]=(t,i)=>{i.preventDefault();let e=t.getPath();/(?:^|>)UL/.test(e)?t.removeList():t.makeUnorderedList()};g[E+"Shift-9"]=(t,i)=>{i.preventDefault();let e=t.getPath();/(?:^|>)OL/.test(e)?t.removeList():t.makeOrderedList()};g[E+"["]=(t,i)=>{i.preventDefault();let e=t.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?t.decreaseQuoteLevel():t.decreaseListLevel()};g[E+"]"]=(t,i)=>{i.preventDefault();let e=t.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?t.increaseQuoteLevel():t.increaseListLevel()};g[E+"d"]=(t,i)=>{i.preventDefault(),t.toggleCode()};g[E+"z"]=(t,i)=>{i.preventDefault(),t.undo()};g[E+"y"]=g[E+"Shift-z"]=(t,i)=>{i.preventDefault(),t.redo()};var Qe=class{_root;_config;_isFocused;_lastSelection;_willRestoreSelection;_mayHaveZWS;_lastAnchorNode;_lastFocusNode;_path;_events;_undoIndex;_undoStack;_undoStackLength;_isInUndoState;_ignoreChange;_ignoreAllChanges;_isShiftDown;_keyHandlers;_mutation;constructor(t,i){this._root=t,this._config=this._makeConfig(i),this._isFocused=!1,this._lastSelection=q(t,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this._isShiftDown=!1,this.addEventListener("cut",Me),this.addEventListener("copy",He),this.addEventListener("paste",ze),this.addEventListener("drop",Ve),this.addEventListener("keydown",Ht),this.addEventListener("keyup",Ht),this.addEventListener("keydown",je),this._keyHandlers=Object.create(g);let e=new MutationObserver(()=>this._docWasChanged());e.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=e,t.setAttribute("contenteditable","true");try{document.execCommand("enableObjectResizing",!1,"false"),document.execCommand("enableInlineTableEditing",!1,"false")}catch{}this.addEventListener("beforeinput",this._beforeInput),this.setHTML("")}destroy(){this._events.forEach((t,i)=>{this.removeEventListener(i)}),this._mutation.disconnect(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(t){let i={blockTag:"DIV",blockAttributes:null,tagAttributes:{},classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,sanitizeToDOMFragment:e=>{let n=DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return n?document.importNode(n,!0):document.createDocumentFragment()},didError:e=>console.log(e)};return t&&(Object.assign(i,t),i.blockTag=i.blockTag.toUpperCase()),i}setKeyHandler(t,i){return this._keyHandlers[t]=i,this}_beforeInput(t){switch(t.inputType){case"insertText":Ne&&t.data&&t.data.includes(`
`)&&t.preventDefault();break;case"insertLineBreak":t.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":t.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":t.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":t.preventDefault(),this.makeUnorderedList();break;case"historyUndo":t.preventDefault(),this.undo();break;case"historyRedo":t.preventDefault(),this.redo();break;case"formatBold":t.preventDefault(),this.bold();break;case"formaItalic":t.preventDefault(),this.italic();break;case"formatUnderline":t.preventDefault(),this.underline();break;case"formatStrikeThrough":t.preventDefault(),this.strikethrough();break;case"formatSuperscript":t.preventDefault(),this.superscript();break;case"formatSubscript":t.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{t.preventDefault();let i=t.inputType.slice(13).toLowerCase();i==="full"&&(i="justify"),this.setTextAlignment(i);break}case"formatRemove":t.preventDefault(),this.removeAllFormatting();break;case"formatSetBlockTextDirection":{t.preventDefault();let i=t.data;i==="null"&&(i=null),this.setTextDirection(i);break}case"formatBackColor":t.preventDefault(),this.setHighlightColor(t.data);break;case"formatFontColor":t.preventDefault(),this.setTextColor(t.data);break;case"formatFontName":t.preventDefault(),this.setFontFace(t.data);break}}handleEvent(t){this.fireEvent(t.type,t)}fireEvent(t,i){let e=this._events.get(t);if(/^(?:focus|blur)/.test(t)){let n=this._root===document.activeElement;if(t==="focus"){if(!n||this._isFocused)return this;this._isFocused=!0}else{if(n||!this._isFocused)return this;this._isFocused=!1}}if(e){let n=i instanceof Event?i:new CustomEvent(t,{detail:i});e=e.slice();for(let s of e)try{"handleEvent"in s?s.handleEvent(n):s.call(this,n)}catch(o){this._config.didError(o)}}return this}customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]);addEventListener(t,i){let e=this._events.get(t),n=this._root;return e||(e=[],this._events.set(t,e),this.customEvents.has(t)||(t==="selectionchange"&&(n=document),n.addEventListener(t,this,!0))),e.push(i),this}removeEventListener(t,i){let e=this._events.get(t),n=this._root;if(e){if(i){let s=e.length;for(;s--;)e[s]===i&&e.splice(s,1)}else e.length=0;e.length||(this._events.delete(t),this.customEvents.has(t)||(t==="selectionchange"&&(n=document),n.removeEventListener(t,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(mt(this._root),this._mayHaveZWS=!1)}startSelectionId="squire-selection-start";endSelectionId="squire-selection-end";_saveRangeToBookmark(t){let i=p("INPUT",{id:this.startSelectionId,type:"hidden"}),e=p("INPUT",{id:this.endSelectionId,type:"hidden"}),n;I(t,i),t.collapse(!1),I(t,e),i.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING&&(i.id=this.endSelectionId,e.id=this.startSelectionId,n=i,i=e,e=n),t.setStartAfter(i),t.setEndBefore(e)}_getRangeAndRemoveBookmark(t){let i=this._root,e=i.querySelector("#"+this.startSelectionId),n=i.querySelector("#"+this.endSelectionId);if(e&&n){let s=e.parentNode,o=n.parentNode,r=Array.from(s.childNodes).indexOf(e),a=Array.from(o.childNodes).indexOf(n);s===o&&(a-=1),e.remove(),n.remove(),t||(t=document.createRange()),t.setStart(s,r),t.setEnd(o,a),j(s,t),s!==o&&j(o,t),t.collapsed&&(s=t.startContainer,s instanceof Text&&(o=s.childNodes[t.startOffset],(!o||!(o instanceof Text))&&(o=s.childNodes[t.startOffset-1]),o&&o instanceof Text&&(t.setStart(o,0),t.collapse(!0))))}return t||null}getSelection(){let t=window.getSelection(),i=this._root,e=null;if(this._isFocused&&t&&t.rangeCount){e=t.getRangeAt(0).cloneRange();let n=e.startContainer,s=e.endContainer;n&&V(n)&&e.setStartBefore(n),s&&V(s)&&e.setEndBefore(s)}return e&&i.contains(e.commonAncestorContainer)?this._lastSelection=e:(e=this._lastSelection,document.contains(e.commonAncestorContainer)||(e=null)),e||(e=q(i.firstElementChild||i,0)),e}setSelection(t){if(this._lastSelection=t,!this._isFocused)this._enableRestoreSelection();else{let i=window.getSelection();i&&("setBaseAndExtent"in Selection.prototype?i.setBaseAndExtent(t.startContainer,t.startOffset,t.endContainer,t.endOffset):(i.removeAllRanges(),i.addRange(t)))}return this}_moveCursorTo(t){let i=this._root,e=q(i,t?0:i.childNodes.length);return T(e),this.setSelection(e),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){let t=this.getSelection(),i=t.getBoundingClientRect();if(i&&!i.top){this._ignoreChange=!0;let e=p("SPAN");e.textContent=Y,I(t,e),i=e.getBoundingClientRect();let n=e.parentNode;n.removeChild(e),j(n,t)}return i}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(t,i){let e=t.startContainer,n=t.endContainer,s;(i||e!==this._lastAnchorNode||n!==this._lastFocusNode)&&(this._lastAnchorNode=e,this._lastFocusNode=n,s=e&&n?e===n?this._getPath(n):"(selection)":"",this._path!==s&&(this._path=s,this.fireEvent("pathChange",{path:s}))),this.fireEvent(t.collapsed?"cursor":"select",{range:t})}_getPath(t){let i=this._root,e=this._config,n="";if(t&&t!==i){let s=t.parentNode;if(n=s?this._getPath(s):"",t instanceof HTMLElement){let o=t.id,r=t.classList,a=Array.from(r).sort(),l=t.dir,c=e.classNames;n+=(n?">":"")+t.nodeName,o&&(n+="#"+o),a.length&&(n+=".",n+=a.join(".")),l&&(n+="[dir="+l+"]"),r.contains(c.highlight)&&(n+="[backgroundColor="+t.style.backgroundColor.replace(/ /g,"")+"]"),r.contains(c.color)&&(n+="[color="+t.style.color.replace(/ /g,"")+"]"),r.contains(c.fontFamily)&&(n+="[fontFamily="+t.style.fontFamily.replace(/ /g,"")+"]"),r.contains(c.fontSize)&&(n+="[fontSize="+t.style.fontSize+"]")}}return n}modifyDocument(t){let i=this._mutation;return i&&(i.takeRecords().length&&this._docWasChanged(),i.disconnect()),this._ignoreAllChanges=!0,t(),this._ignoreAllChanges=!1,i&&(i.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){if(ke(),this._mayHaveZWS=!0,!this._ignoreAllChanges){if(this._ignoreChange){this._ignoreChange=!1;return}this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}}_recordUndoState(t,i){if(!this._isInUndoState||i){let e=this._undoIndex,n=this._undoStack,s=this._config.undo,o=s.documentSizeThreshold,r=s.undoLimit;i||(e+=1),e<this._undoStackLength&&(n.length=this._undoStackLength=e),t&&this._saveRangeToBookmark(t);let a=this._getRawHTML();o>-1&&a.length*2>o&&r>-1&&e>r&&(n.splice(0,e-r),e=r,this._undoStackLength=r),n[e]=a,this._undoIndex=e,this._undoStackLength+=1,this._isInUndoState=!0}return this}saveUndoState(t){return t||(t=this.getSelection()),this._recordUndoState(t,this._isInUndoState),this._getRangeAndRemoveBookmark(t),this}undo(){if(this._undoIndex!==0||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),this._undoIndex-=1,this._setRawHTML(this._undoStack[this._undoIndex]);let t=this._getRangeAndRemoveBookmark();t&&this.setSelection(t),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:this._undoIndex!==0,canRedo:!0}),this.fireEvent("input")}return this}redo(){let t=this._undoIndex,i=this._undoStackLength;if(t+1<i&&this._isInUndoState){this._undoIndex+=1,this._setRawHTML(this._undoStack[this._undoIndex]);let e=this._getRangeAndRemoveBookmark();e&&this.setSelection(e),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:t+2<i}),this.fireEvent("input")}return this}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(t){let i=this._root;i.innerHTML=t;let e=i,n=e.firstChild;if(!n||n.nodeName==="BR"){let s=this.createDefaultBlock();n?e.replaceChild(s,n):e.appendChild(s)}else for(;e=z(e,i);)_(e);return this._ignoreChange=!0,this}getHTML(t){let i;t&&(i=this.getSelection(),this._saveRangeToBookmark(i));let e=this._getRawHTML().replace(/\u200B/g,"");return t&&this._getRangeAndRemoveBookmark(i),e}setHTML(t){let i=this._config.sanitizeToDOMFragment(t,this),e=this._root;gt(i,this._config),at(i,e,!1),D(i,e);let n=i,s=n.firstChild;if(!s||s.nodeName==="BR"){let r=this.createDefaultBlock();s?n.replaceChild(r,s):n.appendChild(r)}else for(;n=z(n,e);)_(n);for(this._ignoreChange=!0;s=e.lastChild;)e.removeChild(s);e.appendChild(i),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;let o=this._getRangeAndRemoveBookmark()||q(e.firstElementChild||e,0);return this.saveUndoState(o),this.setSelection(o),this._updatePath(o,!0),this}insertHTML(t,i){let e=this._config,n=e.sanitizeToDOMFragment(t,this),s=this.getSelection();this.saveUndoState(s);try{let o=this._root;e.addLinks&&this.addDetectedLinks(n,n),gt(n,this._config),at(n,o,!1),_t(n),n.normalize();let r=n;for(;r=z(r,n);)_(r);let a=!0;if(i){let l=new CustomEvent("willPaste",{detail:{fragment:n}});this.fireEvent("willPaste",l),n=l.detail.fragment,a=!l.defaultPrevented}a&&(Fe(s,n,o),s.collapse(!1),It(s,"A",o),this._ensureBottomLine()),this.setSelection(s),this._updatePath(s,!0),i&&this.focus()}catch(o){this._config.didError(o)}return this}insertElement(t,i){if(i||(i=this.getSelection()),i.collapse(!0),v(t))I(i,t),i.setStartAfter(t);else{let e=this._root,n=B(i,e),s=n||e,o=null;for(;s!==e&&!s.nextSibling;)s=s.parentNode;if(s!==e){let a=s.parentNode;o=O(a,s.nextSibling,e,e)}n&&wt(n)&&x(n),e.insertBefore(t,o);let r=this.createDefaultBlock();e.insertBefore(r,o),i.setStart(r,0),i.setEnd(r,0),T(i)}return this.focus(),this.setSelection(i),this._updatePath(i),this}insertImage(t,i){let e=p("IMG",Object.assign({src:t},i));return this.insertElement(e),e}insertPlainText(t,i){let e=this.getSelection();if(e.collapsed&&S(e.startContainer,this._root,"PRE")){let c=e.startContainer,d=e.startOffset,h;if(!c||!(c instanceof Text)){let u=document.createTextNode("");c.insertBefore(u,c.childNodes[d]),h=u,d=0}else h=c;let f=!0;if(i){let u=new CustomEvent("willPaste",{detail:{text:t}});this.fireEvent("willPaste",u),t=u.detail.text,f=!u.defaultPrevented}return f&&(h.insertData(d,t),e.setStart(h,d+t.length),e.collapse(!0)),this.setSelection(e),this}let n=t.split(`
`),s=this._config,o=s.blockTag,r=s.blockAttributes,a="</"+o+">",l="<"+o;for(let c in r)l+=" "+c+'="'+Ft(r[c])+'"';l+=">";for(let c=0,d=n.length;c<d;c+=1){let h=n[c];h=Ft(h).replace(/ (?=(?: |$))/g,"&nbsp;"),c&&(h=l+(h||"<BR>")+a),n[c]=h}return this.insertHTML(n.join(""),i)}getSelectedText(){let t=this.getSelection();if(t.collapsed)return"";let i=t.startContainer,e=t.endContainer,n=new A(t.commonAncestorContainer,K,l=>M(t,l,!0));n.currentNode=i;let s=i,o="",r=!1,a;for((!(s instanceof Element)&&!(s instanceof Text)||!n.filter(s))&&(s=n.nextNode());s;)s instanceof Text?(a=s.data,a&&/\S/.test(a)&&(s===e&&(a=a.slice(0,t.endOffset)),s===i&&(a=a.slice(t.startOffset)),o+=a,r=!0)):(s.nodeName==="BR"||r&&!v(s))&&(o+=`
`,r=!1),s=n.nextNode();return o}getFontInfo(t){let i={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};t||(t=this.getSelection());let e=0,n=t.commonAncestorContainer;if(t.collapsed||n instanceof Text)for(n instanceof Text&&(n=n.parentNode);e<4&&n;){let s=n.style;if(s){let o=s.color;!i.color&&o&&(i.color=o,e+=1);let r=s.backgroundColor;!i.backgroundColor&&r&&(i.backgroundColor=r,e+=1);let a=s.fontFamily;!i.fontFamily&&a&&(i.fontFamily=a,e+=1);let l=s.fontSize;!i.fontSize&&l&&(i.fontSize=l,e+=1)}n=n.parentNode}return i}hasFormat(t,i,e){t=t.toUpperCase(),i||(i={}),e||(e=this.getSelection()),!e.collapsed&&e.startContainer instanceof Text&&e.startOffset===e.startContainer.length&&e.startContainer.nextSibling&&e.setStartBefore(e.startContainer.nextSibling),!e.collapsed&&e.endContainer instanceof Text&&e.endOffset===0&&e.endContainer.previousSibling&&e.setEndAfter(e.endContainer.previousSibling);let n=this._root,s=e.commonAncestorContainer;if(S(s,n,t,i))return!0;if(s instanceof Text)return!1;let o=new A(s,Q,l=>M(e,l,!0)),r=!1,a;for(;a=o.nextNode();){if(!S(a,n,t,i))return!1;r=!0}return r}changeFormat(t,i,e,n){return e||(e=this.getSelection()),this.saveUndoState(e),i&&(e=this._removeFormat(i.tag.toUpperCase(),i.attributes||{},e,n)),t&&(e=this._addFormat(t.tag.toUpperCase(),t.attributes||{},e)),this.setSelection(e),this._updatePath(e,!0),this.focus()}_addFormat(t,i,e){let n=this._root;if(e.collapsed){let s=_(p(t,i));I(e,s);let o=s.firstChild||s,r=o instanceof Text?o.length:0;e.setStart(o,r),e.collapse(!0);let a=s;for(;v(a);)a=a.parentNode;mt(a,s)}else{let s=new A(e.commonAncestorContainer,K,c=>(c instanceof Text||c.nodeName==="BR"||c.nodeName==="IMG")&&M(e,c,!0)),{startContainer:o,startOffset:r,endContainer:a,endOffset:l}=e;if(s.currentNode=o,!(o instanceof Element)&&!(o instanceof Text)||!s.filter(o)){let c=s.nextNode();if(!c)return e;o=c,r=0}do{let c=s.currentNode;if(!S(c,n,t,i)){c===a&&c.length>l&&c.splitText(l),c===o&&r&&(c=c.splitText(r),a===o?(a=c,l-=r):a===o.parentNode&&(l+=1),o=c,r=0);let h=p(t,i);b(c,h),h.appendChild(c)}}while(s.nextNode());e=q(o,r,a,l)}return e}_removeFormat(t,i,e,n){this._saveRangeToBookmark(e);let s;e.collapsed&&(St?s=document.createTextNode(Y):s=document.createTextNode(""),I(e,s));let o=e.commonAncestorContainer;for(;v(o);)o=o.parentNode;let r=e.startContainer,a=e.startOffset,l=e.endContainer,c=e.endOffset,d=[],h=(u,m)=>{if(M(e,u,!1))return;let N,w;if(!M(e,u,!0)){!(u instanceof HTMLInputElement)&&(!(u instanceof Text)||u.data)&&d.push([m,u]);return}if(u instanceof Text)u===l&&c!==u.length&&d.push([m,u.splitText(c)]),u===r&&a&&(u.splitText(a),d.push([m,u]));else for(N=u.firstChild;N;N=w)w=N.nextSibling,h(N,m)},f=Array.from(o.getElementsByTagName(t)).filter(u=>M(e,u,!0)&&Nt(u,t,i));return n||f.forEach(u=>{h(u,u)}),d.forEach(([u,m])=>{u=u.cloneNode(!1),b(m,u),u.appendChild(m)}),f.forEach(u=>{b(u,C(u))}),this._getRangeAndRemoveBookmark(e),s&&e.collapse(!1),j(o,e),e}bold(){return this.changeFormat({tag:"B"})}removeBold(){return this.changeFormat(null,{tag:"B"})}italic(){return this.changeFormat({tag:"I"})}removeItalic(){return this.changeFormat(null,{tag:"I"})}underline(){return this.changeFormat({tag:"U"})}removeUnderline(){return this.changeFormat(null,{tag:"U"})}strikethrough(){return this.changeFormat({tag:"S"})}removeStrikethrough(){return this.changeFormat(null,{tag:"S"})}subscript(){return this.changeFormat({tag:"SUB"},{tag:"SUP"})}removeSubscript(){return this.changeFormat(null,{tag:"SUB"})}superscript(){return this.changeFormat({tag:"SUP"},{tag:"SUB"})}removeSuperscript(){return this.changeFormat(null,{tag:"SUP"})}makeLink(t,i){let e=this.getSelection();if(e.collapsed){let n=t.indexOf(":")+1;if(n)for(;t[n]==="/";)n+=1;I(e,document.createTextNode(t.slice(n)))}return i=Object.assign({href:t},this._config.tagAttributes.a,i),this.changeFormat({tag:"A",attributes:i},{tag:"A"},e)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i;addDetectedLinks(t,i){let e=new A(t,Q,r=>!S(r,i||this._root,"A")),n=this.linkRegExp,s=this._config.tagAttributes.a,o;for(;o=e.nextNode();){let r=o.parentNode,a=o.data,l;for(;l=n.exec(a);){let c=l.index,d=c+l[0].length;c&&r.insertBefore(document.createTextNode(a.slice(0,c)),o);let h=p("A",Object.assign({href:l[1]?/^(?:ht|f)tps?:/i.test(l[1])?l[1]:"http://"+l[1]:"mailto:"+l[0]},s));h.textContent=a.slice(c,d),r.insertBefore(h,o),o.data=a=a.slice(d)}}return this}setFontFace(t){let i=this._config.classNames.fontFamily;return this.changeFormat(t?{tag:"SPAN",attributes:{class:i,style:"font-family: "+t+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:i}})}setFontSize(t){let i=this._config.classNames.fontSize;return this.changeFormat(t?{tag:"SPAN",attributes:{class:i,style:"font-size: "+(typeof t=="number"?t+"px":t)}}:null,{tag:"SPAN",attributes:{class:i}})}setTextColor(t){let i=this._config.classNames.color;return this.changeFormat(t?{tag:"SPAN",attributes:{class:i,style:"color:"+t}}:null,{tag:"SPAN",attributes:{class:i}})}setHighlightColor(t){let i=this._config.classNames.highlight;return this.changeFormat(t?{tag:"SPAN",attributes:{class:i,style:"background-color:"+t}}:null,{tag:"SPAN",attributes:{class:i}})}_ensureBottomLine(){let t=this._root,i=t.lastElementChild;(!i||i.nodeName!==this._config.blockTag||!H(i))&&t.appendChild(this.createDefaultBlock())}createDefaultBlock(t){let i=this._config;return _(p(i.blockTag,i.blockAttributes,t))}tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"};splitBlock(t,i){i||(i=this.getSelection());let e=this._root,n,s,o,r;if(this._recordUndoState(i),this._removeZWS(),this._getRangeAndRemoveBookmark(i),i.collapsed||G(i,e),this._config.addLinks){T(i);let h=i.startContainer,f=i.startOffset;setTimeout(()=>{ee(this,h,f)},0)}if(n=B(i,e),n&&(s=S(n,e,"PRE"))){T(i),o=i.startContainer;let h=i.startOffset;return o instanceof Text||(o=document.createTextNode(""),s.insertBefore(o,s.firstChild)),!t&&o instanceof Text&&(o.data.charAt(h-1)===`
`||nt(i,e))&&(o.data.charAt(h)===`
`||dt(i,e))?(o.deleteData(h&&h-1,h?2:1),r=O(o,h&&h-1,e,e),o=r.previousSibling,o.textContent||x(o),o=this.createDefaultBlock(),r.parentNode.insertBefore(o,r),r.textContent||x(r),i.setStart(o,0)):(o.insertData(h,`
`),_(s),o.length===h+1?i.setStartAfter(o):i.setStart(o,h+1)),i.collapse(!0),this.setSelection(i),this._updatePath(i,!0),this._docWasChanged(),this}if(!n||t||/^T[HD]$/.test(n.nodeName))return It(i,"A",e),I(i,p("BR")),i.collapse(!1),this.setSelection(i),this._updatePath(i,!0),this;if((s=S(n,e,"LI"))&&(n=s),wt(n)){if(S(n,e,"UL")||S(n,e,"OL"))return this.decreaseListLevel(i),this;if(S(n,e,"BLOCKQUOTE"))return this.removeQuote(i),this}o=i.startContainer;let a=i.startOffset,l=this.tagAfterSplit[n.nodeName];r=O(o,a,n.parentNode,this._root);let c=this._config,d=null;for(l||(l=c.blockTag,d=c.blockAttributes),Nt(r,l,d)||(n=p(l,d),r.dir&&(n.dir=r.dir),b(r,n),n.appendChild(C(r)),r=n),mt(n),_t(n),_(n);r instanceof Element;){let h=r.firstChild,f;if(r.nodeName==="A"&&(!r.textContent||r.textContent===Y)){h=document.createTextNode(""),b(r,h),r=h;break}for(;h&&h instanceof Text&&!h.data&&(f=h.nextSibling,!(!f||f.nodeName==="BR"));)x(h),h=f;if(!h||h.nodeName==="BR"||h instanceof Text)break;r=h}return i=q(r,0),this.setSelection(i),this._updatePath(i,!0),this}forEachBlock(t,i,e){e||(e=this.getSelection()),i&&this.saveUndoState(e);let n=this._root,s=B(e,n),o=Z(e,n);if(s&&o)do if(t(s)||s===o)break;while(s=z(s,n));return i&&(this.setSelection(e),this._updatePath(e,!0)),this}modifyBlocks(t,i){i||(i=this.getSelection()),this._recordUndoState(i,this._isInUndoState);let e=this._root;Ut(i,e),W(i,e,e,e);let n=Jt(i,e,e);if(!i.collapsed){let s=i.endContainer;if(s===e)i.collapse(!1);else{for(;s.parentNode!==e;)s=s.parentNode;i.setStartBefore(s),i.collapse(!0)}}return I(i,t.call(this,n)),i.endOffset<i.endContainer.childNodes.length&&F(i.endContainer.childNodes[i.endOffset],e),F(i.startContainer.childNodes[i.startOffset],e),this._getRangeAndRemoveBookmark(i),this.setSelection(i),this._updatePath(i,!0),this}setTextAlignment(t){return this.forEachBlock(i=>{let e=i.className.split(/\s+/).filter(n=>!!n&&!/^align/.test(n)).join(" ");t?(i.className=e+" align-"+t,i.style.textAlign=t):(i.className=e,i.style.textAlign="")},!0),this.focus()}setTextDirection(t){return this.forEachBlock(i=>{t?i.dir=t:i.removeAttribute("dir")},!0),this.focus()}_getListSelection(t,i){let e=t.commonAncestorContainer,n=t.startContainer,s=t.endContainer;for(;e&&e!==i&&!/^[OU]L$/.test(e.nodeName);)e=e.parentNode;if(!e||e===i)return null;for(n===e&&(n=n.childNodes[t.startOffset]),s===e&&(s=s.childNodes[t.endOffset]);n&&n.parentNode!==e;)n=n.parentNode;for(;s&&s.parentNode!==e;)s=s.parentNode;return[e,n,s]}increaseListLevel(t){t||(t=this.getSelection());let i=this._root,e=this._getListSelection(t,i);if(!e)return this.focus();let[n,s,o]=e;if(!s||s===n.firstChild)return this.focus();this._recordUndoState(t,this._isInUndoState);let r=n.nodeName,a=s.previousSibling,l,c;a.nodeName!==r&&(l=this._config.tagAttributes[r.toLowerCase()],a=p(r,l),n.insertBefore(a,s));do c=s===o?null:s.nextSibling,a.appendChild(s);while(s=c);return c=a.nextSibling,c&&F(c,i),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}decreaseListLevel(t){t||(t=this.getSelection());let i=this._root,e=this._getListSelection(t,i);if(!e)return this.focus();let[n,s,o]=e;s||(s=n.firstChild),o||(o=n.lastChild),this._recordUndoState(t,this._isInUndoState);let r,a=null;if(s){let l=n.parentNode;if(a=o.nextSibling?O(n,o.nextSibling,l,i):n.nextSibling,l!==i&&l.nodeName==="LI"){for(l=l.parentNode;a;)r=a.nextSibling,o.appendChild(a),a=r;a=n.parentNode.nextSibling}let c=!/^[OU]L$/.test(l.nodeName);do r=s===o?null:s.nextSibling,n.removeChild(s),c&&s.nodeName==="LI"&&(s=this.createDefaultBlock([C(s)])),l.insertBefore(s,a);while(s=r)}return n.firstChild||x(n),a&&F(a,i),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}_makeList(t,i){let e=lt(t,this._root),n=this._config.tagAttributes,s=n[i.toLowerCase()],o=n.li,r;for(;r=e.nextNode();)if(r.parentNode instanceof HTMLLIElement&&(r=r.parentNode,e.currentNode=r.lastChild),r instanceof HTMLLIElement){r=r.parentNode;let a=r.nodeName;a!==i&&/^[OU]L$/.test(a)&&b(r,p(i,s,[C(r)]))}else{let a=p("LI",o);r.dir&&(a.dir=r.dir);let l=r.previousSibling;l&&l.nodeName===i?(l.appendChild(a),x(r)):b(r,p(i,s,[a])),a.appendChild(C(r)),e.currentNode=a}return t}makeUnorderedList(){return this.modifyBlocks(t=>this._makeList(t,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(t=>this._makeList(t,"OL")),this.focus()}removeList(){return this.modifyBlocks(t=>{let i=t.querySelectorAll("UL, OL"),e=t.querySelectorAll("LI"),n=this._root;for(let s=0,o=i.length;s<o;s+=1){let r=i[s],a=C(r);D(a,n),b(r,a)}for(let s=0,o=e.length;s<o;s+=1){let r=e[s];H(r)?b(r,this.createDefaultBlock([C(r)])):(D(r,n),b(r,C(r)))}return t}),this.focus()}increaseQuoteLevel(t){return this.modifyBlocks(i=>p("BLOCKQUOTE",this._config.tagAttributes.blockquote,[i]),t),this.focus()}decreaseQuoteLevel(t){return this.modifyBlocks(i=>(Array.from(i.querySelectorAll("blockquote")).filter(e=>!S(e.parentNode,i,"BLOCKQUOTE")).forEach(e=>{b(e,C(e))}),i),t),this.focus()}removeQuote(t){return this.modifyBlocks(()=>this.createDefaultBlock([p("INPUT",{id:this.startSelectionId,type:"hidden"}),p("INPUT",{id:this.endSelectionId,type:"hidden"})]),t),this.focus()}code(){let t=this.getSelection();return t.collapsed||J(t.commonAncestorContainer)?(this.modifyBlocks(i=>{let e=this._root,n=document.createDocumentFragment(),s=lt(i,e),o;for(;o=s.nextNode();){let a=o.querySelectorAll("BR"),l=[],c=a.length;for(let d=0;d<c;d+=1)l[d]=ct(a[d],!1);for(;c--;){let d=a[c];l[c]?b(d,document.createTextNode(`
`)):x(d)}for(a=o.querySelectorAll("CODE"),c=a.length;c--;)b(a[c],C(a[c]));n.childNodes.length&&n.appendChild(document.createTextNode(`
`)),n.appendChild(C(o))}let r=new A(n,Q);for(;o=r.nextNode();)o.data=o.data.replace(/ /g," ");return n.normalize(),_(p("PRE",this._config.tagAttributes.pre,[n]))},t),this.focus()):this.changeFormat({tag:"CODE",attributes:this._config.tagAttributes.code},null,t),this}removeCode(){let t=this.getSelection(),i=t.commonAncestorContainer;return S(i,this._root,"PRE")?(this.modifyBlocks(n=>{let s=this._root,o=n.querySelectorAll("PRE"),r=o.length;for(;r--;){let a=o[r],l=new A(a,Q),c;for(;c=l.nextNode();){let d=c.data;d=d.replace(/ (?= )/g,"\xA0");let h=document.createDocumentFragment(),f;for(;(f=d.indexOf(`
`))>-1;)h.appendChild(document.createTextNode(d.slice(0,f))),h.appendChild(p("BR")),d=d.slice(f+1);c.parentNode.insertBefore(h,c),c.data=d}D(a,s),b(a,C(a))}return n},t),this.focus()):this.changeFormat(null,{tag:"CODE"},t),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}_removeFormatting(t,i){for(let e=t.firstChild,n;e;e=n){if(n=e.nextSibling,v(e)){if(e instanceof Text||e.nodeName==="BR"||e.nodeName==="IMG"){i.appendChild(e);continue}}else if(H(e)){i.appendChild(this.createDefaultBlock([this._removeFormatting(e,document.createDocumentFragment())]));continue}this._removeFormatting(e,i)}return i}removeAllFormatting(t){if(t||(t=this.getSelection()),t.collapsed)return this.focus();let i=this._root,e=t.commonAncestorContainer;for(;e&&!H(e);)e=e.parentNode;if(e||(Ut(t,i),e=i),e instanceof Text)return this.focus();this.saveUndoState(t),W(t,e,e,i);let n=t.startContainer,s=t.startOffset,o=t.endContainer,r=t.endOffset,a=document.createDocumentFragment(),l=document.createDocumentFragment(),c=O(o,r,e,i),d=O(n,s,e,i),h;for(;d!==c;)h=d.nextSibling,a.appendChild(d),d=h;if(this._removeFormatting(a,l),l.normalize(),d=l.firstChild,h=l.lastChild,d){e.insertBefore(l,c);let f=Array.from(e.childNodes);s=f.indexOf(d),r=h?f.indexOf(h)+1:0}else c&&(s=Array.from(e.childNodes).indexOf(c),r=s);return t.setStart(e,s),t.setEnd(e,r),j(e,t),T(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}},ie=Qe;function ht(t){for(let[i,e]of Object.entries(t))if(e&&typeof e=="object"){let n=e.__fn;n?typeof n=="string"?t[i]=n.split(".").reduce((s,o)=>s[o],window):Array.isArray(n)&&(t[i]=new Function(n[0],n[1])):ht(e)}return t}function ft(t){let i=t;do{if(i.nextSibling){t.parsedCallback();return}i=i.parentNode}while(i);setTimeout(()=>{ft(t)})}var kt,Et=class extends HTMLElement{connectedCallback(){kt&&clearTimeout(kt),ft(this)}disconnectedCallback(){this.disconnected(),kt=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=ht(JSON.parse(this.dataset.config||"{}")),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},ne=Et;function R(t,i={}){let e=document.createElement(t);for(let[n,s]of Object.entries(i))e[n]=s;return e}function Ye(t,i,e){return i=i||t,e.nodeType==1&&(i=`:scope ${i}`),i}function U(t,i=null,e=document){return e.querySelector(Ye(t,i,e))}function Lt(t){let i=R("template");return i.innerHTML=t,i.content}function At(t,i,e=!1){window.Sanitizer&&!e?t.setHTML(i):window.DOMPurify?t.innerHTML=window.DOMPurify.sanitize(i,{WHOLE_DOCUMENT:!1,FORCE_BODY:!1}):t.innerHTML=i}async function se(t=!1){(!window.Sanitizer||t)&&!window.DOMPurify&&(window.DOMPurify=(await import("https://cdn.jsdelivr.net/npm/dompurify@3/+esm")).default)}function ut(){return window.bootstrap}function Ot(t,i){if(!document.head.querySelector(`#${t}-style`)){let e=document.createElement("style");e.id=`${t}-style`,e.innerText=i,document.head.append(e)}}var oe=!1,yt="squire-editor",Je=`
.squire-editor {
  position:relative;
  display:block;
}
.squire-editor .squire-toolbar {
  position:absolute;
  top:0;
  background:#EFEFEF;
  overflow:hidden;
}
.squire-editor .squire-toolbar-group {
  border-right:1px solid rgba(100,100,100,0.2);
  display:inline-block;
}
.squire-editor .squire-toolbar-group:last-child {
  border-right:0;
}
.squire-editor .squire-toolbar button {
  border:0;
  height:38px;
  width:38px;
  background:transparent;
}
.squire-editor .squire-toolbar button:hover {
  background:rgba(100,100,100,0.2);
}
`;Ot(yt,Je);function ae(t,i,e){if(!t||!i)return;let n=window.getComputedStyle(t),s=window.getComputedStyle(i),o=window.getComputedStyle(e);t.dataset.defaultPadding||(t.dataset.defaultPadding=n.paddingTop),e.dataset.defaultPadding||(e.dataset.defaultPadding=o.paddingTop),i.style.top=`${n.borderTopWidth}`,i.style.left=`${n.borderLeftWidth}`,i.style.right=`${n.borderRightWidth}`,i.style.borderTopLeftRadius=`${n.borderRadius}`,i.style.borderTopRightRadius=`${n.borderRadius}`,t.style.paddingTop=`calc(${t.dataset.defaultPadding} + ${s.height})`,e.style.paddingTop=`calc(${e.dataset.defaultPadding} + ${s.height})`}var re=new ResizeObserver(t=>{for(let i of t){let e=i.target,n=e.offsetWidth.toString();if(n!=e.dataset.width&&(e.dataset.width=n,i.contentBoxSize)){let s=U("textarea",null,e),o=U("div",".squire-input",e),r=U("div",".squire-toolbar",e);ae(o,r,s)}}}),pt=class extends ne{get el(){return U("textarea",null,this)}created(){if(!this.el){let e=R("textarea",{name:this.getAttribute("name"),value:this.getAttribute("value")});ut()&&e.classList.add("form-control"),this.appendChild(e)}this.classList.add("squire-editor");let i=this.el;i.setAttribute("hidden",""),i.style.overflow="hidden",i.spellcheck=!1,this.init()}async init(){await se(oe);let i=U("div",".squire-toolbar",this),e=U("div",".squire-input",this);if(i&&i.remove(),e&&e.remove(),!this.dataset.toolbar){i=R("div"),i.classList.add("squire-toolbar"),this.appendChild(i);let o=[[{name:"bold",action:"bold",format:"b",removeAction:"removeBold",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13H8.21zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.673zm0 6.788V8.598h1.73c1.217 0 1.88.492 1.88 1.415 0 .943-.643 1.449-1.832 1.449H5.907z"/>
        </svg>`},{name:"italic",action:"italic",format:"i",removeAction:"removeItalic",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.06.096 1.128.212 1.005.807L6.57 11.674c-.123.595-.246.71-1.346.806l-.11.52h3.774l.11-.52c-1.06-.095-1.129-.211-1.006-.806z"/>
        </svg>`},{name:"underline",action:"underline",format:"u",removeAction:"removeUnderline",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 3.917 3.623s3.917-1.518 3.917-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-2.687 2.57-1.709 0-2.687-1.08-2.687-2.57V3.136zM12.5 15h-9v-1h9v1z"/>
        </svg>`},{name:"strikethrough",action:"strikethrough",format:"s",removeAction:"removeStrikethrough",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M6.333 5.686c0 .31.083.581.27.814H5.166a2.776 2.776 0 0 1-.099-.76c0-1.627 1.436-2.768 3.48-2.768 1.969 0 3.39 1.175 3.445 2.85h-1.23c-.11-1.08-.964-1.743-2.25-1.743-1.23 0-2.18.602-2.18 1.607zm2.194 7.478c-2.153 0-3.589-1.107-3.705-2.81h1.23c.144 1.06 1.129 1.703 2.544 1.703 1.34 0 2.31-.705 2.31-1.675 0-.827-.547-1.374-1.914-1.675L8.046 8.5H1v-1h14v1h-3.504c.468.437.675.994.675 1.697 0 1.826-1.436 2.967-3.644 2.967z"/>
          </svg>`},{name:"code",action:"code",format:"code",removeAction:"removeCode",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-code" viewBox="0 0 16 16">
          <path d="M5.854 4.854a.5.5 0 1 0-.708-.708l-3.5 3.5a.5.5 0 0 0 0 .708l3.5 3.5a.5.5 0 0 0 .708-.708L2.707 8l3.147-3.146zm4.292 0a.5.5 0 0 1 .708-.708l3.5 3.5a.5.5 0 0 1 0 .708l-3.5 3.5a.5.5 0 0 1-.708-.708L13.293 8l-3.147-3.146z"/>
        </svg>`},{name:"link",action:"makeLink",prompt:!0,format:"a",removeAction:"removeLink",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
            <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
            <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
          </svg>`},{name:"remove_formatting",action:"removeAllFormatting",icon:`<svg width="16" height="16" viewBox="0 0 24 24" focusable="false">
          <path d="M13.2 6a1 1 0 0 1 0 .2l-2.6 10a1 1 0 0 1-1 .8h-.2a.8.8 0 0 1-.8-1l2.6-10H8a1 1 0 1 1 0-2h9a1 1 0 0 1 0 2h-3.8ZM5 18h7a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Zm13 1.5L16.5 18 15 19.5a.7.7 0 0 1-1-1l1.5-1.5-1.5-1.5a.7.7 0 0 1 1-1l1.5 1.5 1.5-1.5a.7.7 0 0 1 1 1L17.5 17l1.5 1.5a.7.7 0 0 1-1 1Z" fill-rule="evenodd"></path>
        </svg>`}],[{name:"h1",action:"changeFormat",format:"h1",removeAction:"changeFormat",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8.637 13V3.669H7.379V7.62H2.758V3.67H1.5V13h1.258V8.728h4.62V13h1.259zm5.329 0V3.669h-1.244L10.5 5.316v1.265l2.16-1.565h.062V13h1.244z"/>
          </svg>`},{name:"h2",action:"changeFormat",format:"h2",removeAction:"changeFormat",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M7.638 13V3.669H6.38V7.62H1.759V3.67H.5V13h1.258V8.728h4.62V13h1.259zm3.022-6.733v-.048c0-.889.63-1.668 1.716-1.668.957 0 1.675.608 1.675 1.572 0 .855-.554 1.504-1.067 2.085l-3.513 3.999V13H15.5v-1.094h-4.245v-.075l2.481-2.844c.875-.998 1.586-1.784 1.586-2.953 0-1.463-1.155-2.556-2.919-2.556-1.941 0-2.966 1.326-2.966 2.74v.049h1.223z"/>
          </svg>`},{name:"h3",action:"changeFormat",format:"h3",removeAction:"changeFormat",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M7.637 13V3.669H6.379V7.62H1.758V3.67H.5V13h1.258V8.728h4.62V13h1.259zm3.625-4.272h1.018c1.142 0 1.935.67 1.949 1.674.013 1.005-.78 1.737-2.01 1.73-1.08-.007-1.853-.588-1.935-1.32H9.108c.069 1.327 1.224 2.386 3.083 2.386 1.935 0 3.343-1.155 3.309-2.789-.027-1.51-1.251-2.16-2.037-2.249v-.068c.704-.123 1.764-.91 1.723-2.229-.035-1.353-1.176-2.4-2.954-2.385-1.873.006-2.857 1.162-2.898 2.358h1.196c.062-.69.711-1.299 1.696-1.299.998 0 1.695.622 1.695 1.525.007.922-.718 1.592-1.695 1.592h-.964v1.074z"/>
          </svg>`},{name:"ul",action:"makeUnorderedList",format:"ul",removeAction:"removeList",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
          </svg>`},{name:"ol",action:"makeOrderedList",format:"ol",removeAction:"removeList",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/>
            <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/>
          </svg>`},{name:"quote",action:"increaseQuoteLevel",format:"blockquote",removeAction:"removeQuote",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M12 12a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1h-1.388c0-.351.021-.703.062-1.054.062-.372.166-.703.31-.992.145-.29.331-.517.559-.683.227-.186.516-.279.868-.279V3c-.579 0-1.085.124-1.52.372a3.322 3.322 0 0 0-1.085.992 4.92 4.92 0 0 0-.62 1.458A7.712 7.712 0 0 0 9 7.558V11a1 1 0 0 0 1 1h2Zm-6 0a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1H4.612c0-.351.021-.703.062-1.054.062-.372.166-.703.31-.992.145-.29.331-.517.559-.683.227-.186.516-.279.868-.279V3c-.579 0-1.085.124-1.52.372a3.322 3.322 0 0 0-1.085.992 4.92 4.92 0 0 0-.62 1.458A7.712 7.712 0 0 0 3 7.558V11a1 1 0 0 0 1 1h2Z"/>
          </svg>`}],[{name:"undo",action:"undo",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
          </svg>`},{name:"redo",action:"redo",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
          </svg>`},{name:"html",action:"html",icon:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5Zm-9.736 7.35v3.999h-.791v-1.714H1.79v1.714H1V11.85h.791v1.626h1.682V11.85h.79Zm2.251.662v3.337h-.794v-3.337H4.588v-.662h3.064v.662H6.515Zm2.176 3.337v-2.66h.038l.952 2.159h.516l.946-2.16h.038v2.661h.715V11.85h-.8l-1.14 2.596H9.93L8.79 11.85h-.805v3.999h.706Zm4.71-.674h1.696v.674H12.61V11.85h.79v3.325Z"/>
          </svg>`}]],r=this.dataset.buttons?this.dataset.buttons.split(","):[],a=(l,c=i)=>{if(r.length&&!r.includes(l.name))return;let d=R("button");d.type="button",d.innerHTML=l.icon,d.dataset.action=l.action,d.dataset.removeAction=l.removeAction,d.dataset.format=l.format,d.dataset.prompt=l.prompt||"",d.ariaLabel=l.name,c.appendChild(d)};o.forEach(l=>{if(Array.isArray(l)){let c=R("div");c.classList.add("squire-toolbar-group"),i.appendChild(c),l.forEach(d=>a(d,c))}else a(l)})}e=R("div"),e.classList.add("squire-input"),ut()&&e.classList.add("form-control"),this.appendChild(e);let s=this.el;ae(e,i,s),this.config=Object.assign({blockTag:"div",blockAttributes:{class:"paragraph"},tagAttributes:{blockquote:{class:"blockquote"}},sanitizeToDOMFragment:(o,r)=>{let a=R("div");At(a,o,oe);let l=Lt(a.innerHTML);return l?document.importNode(l,!0):document.createDocumentFragment()}},this.config),this.editor=new ie(e,this.config),this.editor.setHTML(s.value),this.editor.addEventListener("input",()=>{let o=this.editor.getHTML();this.el.value=o}),this.dataset.allowPaste&&this.editor.addEventListener("pasteImage",o=>{let a=[...o.detail.clipboardData.items].filter(c=>/image/.test(c.type));if(!a.length)return!1;let l=new FileReader;l.onload=c=>{this.editor.insertImage(c.target.result)},l.readAsDataURL(a[0].getAsFile())})}connected(){this.addEventListener("click",this),this.addEventListener("input",this),re.observe(this)}disconnected(){this.removeEventListener("click",this),this.removeEventListener("input",this),re.unobserve(this)}handleEvent(i){this[`_${i.type}`](i)}_undoStateChange(i){this._input(i)}_input(i){i.target===this.el&&(this.el.style.height="0",this.el.style.height=this.el.scrollHeight+"px")}_click(i){let e=i.target.closest("button");if(!e)return;let n=this.editor,s=e.dataset.action,o=e.dataset.removeAction,r=e.dataset.format,a=e.dataset.prompt,l,c,d=U("div",".squire-input",this);if(s==="html"){let h=U("textarea",null,this);if(h.hasAttribute("hidden")){let f=Math.max(parseInt(window.getComputedStyle(d).height),h.scrollHeight);h.style.height=f+"px",d.setAttribute("hidden",""),h.removeAttribute("hidden")}else this.editor.setHTML(h.value),h.setAttribute("hidden",""),d.removeAttribute("hidden");return}if(s&&n&&n[s]){if(d.hasAttribute("hidden"))return;let h=n.getSelection();if(r&&o&&n.hasFormat(r))o==="changeFormat"&&(l=null,c={tag:r}),n[o](l,c);else{if(a){if(h.collapsed)return;if(l=window.prompt(),!l){n[o](l,c);return}}s==="changeFormat"&&(l={tag:r}),n[s](l,c)}}}destroyed(){this.editor.destroy(),this.editor=null}};customElements.get(yt)||customElements.define(yt,pt);var xi=pt;})();
