"use strict";(()=>{var T="superfile",R="superfile-preview",H="superfile-preview-active",_="superfile-clear",z="superfile-ready",u="superfile-drag",D="superfile-clone";var m=class{constructor(e){this.inputElement=e,this.holderElement=e.parentElement,this.holderElement.classList.contains(T)||(this.holderElement=this.holderElement.parentElement),this.previewElement=this.holderElement.querySelector("img."+R),this.clearElement=this.holderElement.querySelector("."+_),this.disableResize=!!e.dataset.disableResize,this.maxWidth=e.dataset.maxWidth?parseInt(e.dataset.maxWidth):1024,this.maxHeight=e.dataset.maxHeight?parseInt(e.dataset.maxHeight):1024,this.hideClear=!!e.dataset.hideClear,this.imageRatio=e.dataset.ratio?e.dataset.ratio.split(/\/|:/):null,this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",t=>{this.processFiles(()=>{this.showPreview()})}),this.clearElement&&this.clearElement.addEventListener("click",t=>{this.clearPreview()}),this.holderElement.addEventListener("dragleave",t=>{this.onDragleave(t)}),this.holderElement.addEventListener("dragover",t=>{this.onDragover(t)}),this.holderElement.addEventListener("drop",t=>{this.onDrop(t)}),this.holderElement.classList.add(z)}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let i=0;i<t.length;i++){let s=t[i],a=new m(s)}}onDrop(e){e.stopPropagation(),e.preventDefault(),this.inputElement.files=e.dataTransfer.files,this.inputElement.dispatchEvent(new Event("change")),this.holderElement.classList.remove(u)}onDragover(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.contains(u)||this.holderElement.classList.add(u),e.dataTransfer.dropEffect="copy"}onDragleave(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.remove(u)}showPreview(){if(!this.previewElement)return;this.holderElement.classList.add(H),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay);let e=this.previewElement.parentElement;for(let t=0;t<this.inputElement.files.length;t++){let i=this.inputElement.files[t];if(!i.type.match(/image.*/))continue;let s=e.querySelectorAll("."+R)[t];s||(s=this.previewElement.cloneNode(!0),s.classList.add(D),e.appendChild(s)),s.src=URL.createObjectURL(i)}}clearPreview(){if(this.previewElement){this.holderElement.classList.remove(H),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none");let e=this.holderElement.querySelectorAll("."+D);for(let t=0;t<e.length;t++)e[t].parentElement.removeChild(e[t])}this.inputElement.value=null}resizeImage(e,t,i){let s=document.createElement("canvas"),a=0,o=0,h=t.naturalWidth,p=t.naturalHeight,y=h,w=p,l=h,r=p,b=l>this.maxWidth||r>this.maxHeight,x=l/r,d=x,f=!1;if(this.imageRatio&&(d=this.imageRatio[0]/this.imageRatio[1],f=this.imageRatio!==d),!b&&!f){i();return}f&&(x>d?l=r*d:x<d&&(r=l/d),a=(h-l)/2,o=(p-r)/2),l>this.maxWidth&&(r*=this.maxWidth/l,y*=this.maxWidth/l,w*=this.maxWidth/l,l=this.maxWidth),r>this.maxHeight&&(l*=this.maxHeight/r,y*=this.maxHeight/r,w*=this.maxHeight/r,r=this.maxHeight),l=Math.round(l),r=Math.round(r),s.width=l,s.height=r;let c=s.getContext("2d");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",f?c.drawImage(t,a,o,h,p,0,0,y,w):c.drawImage(t,0,0,l,r),c.canvas.toBlob(P=>{this.createProcessedFile(e,P,i)},e.type,1)}handleResizeImage(e,t){if(!e.type.match(/image.*/)){t();return}if(this.disableResize){t();return}let i=new FileReader;i.onload=s=>{let a=new Image;a.onload=()=>{this.resizeImage(e,a,t)},a.onerror=o=>{},a.src=s.target.result},i.onerror=s=>{console.log(s)},i.readAsDataURL(e)}createProcessedFile(e,t,i){let s=new File([t],e.name,{type:e.type,lastModified:Date.now()}),a=new DataTransfer;for(let o=0;o<this.inputElement.files.length;o++){let h=this.inputElement.files[o];h.name===e.name?a.items.add(s):a.items.add(h)}this.inputElement.files=a.files,i()}processFiles(e){let t=this.inputElement.files;if(!t.length){e();return}for(let i=0;i<t.length;i++)this.handleResizeImage(t[i],e)}},I=m;function g(n){for(let[e,t]of Object.entries(n))if(t&&typeof t=="object"){let i=t.__fn;i?typeof i=="string"?n[e]=i.split(".").reduce((s,a)=>s[a],window):Array.isArray(i)&&(n[e]=new Function(i[0],i[1])):g(t)}return n}function E(n){let e=n;do{if(e.nextSibling){n.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{E(n)})}var L,S=class extends HTMLElement{connectedCallback(){L&&clearTimeout(L),E(this)}disconnectedCallback(){this.disconnected(),L=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=g(JSON.parse(this.dataset.config||"{}")),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},W=S;function A(n,e){if(!document.head.querySelector(`#${n}-style`)){let t=document.createElement("style");t.id=`${n}-style`,t.innerText=e,document.head.append(t)}}var C="superfile-input";A(C,`img:not([src]) {
  display: none;
}
.superfile:not(.superfile-ready) {
  visibility: hidden;
}
.superfile-drag input {
  background: var(--bs-highlight-bg, palegoldenrod);
}`);var v=class extends W{get el(){return this.querySelector("input")}created(){let e=this.el;this.superfile=new I(e)}destroyed(){this.superfile=null}};customElements.get(C)||customElements.define(C,v);var j=v;})();
