"use strict";(()=>{var L={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",queryParam:"query",items:[],source:null,hiddenInput:!1,hiddenValue:"",datalist:"",server:"",serverMethod:"GET",serverParams:{},fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(r,e,t)=>e,onSelectItem:(r,e)=>{},onServerResponse:(r,e)=>r.json()},x="is-loading",A="is-active",l="show",c="next",C="prev",d=new WeakMap,u=0;function M(r,e=300){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,s)},e)}}function _(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function k(r,e){return r.parentNode.insertBefore(e,r.nextSibling)}var m=class{constructor(e,t={}){if(!(e instanceof HTMLElement)){console.error("Invalid element",e);return}d.set(e,this),u++,this._searchInput=e,this._configure(t),this._preventInput=!1,this._keyboardNavigation=!1,this._searchFunc=M(()=>{this._loadFromServer(!0)},this._config.debounceTime),this._configureSearchInput(),this._configureDropElement(),this._config.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this._searchInput.addEventListener("focus",this),this._searchInput.addEventListener("blur",this),this._searchInput.addEventListener("input",this),this._searchInput.addEventListener("keydown",this),this._dropElement.addEventListener("mousemove",this),this._fetchData()}static init(e="input.autocomplete",t={}){document.querySelectorAll(e).forEach(o=>{this.getOrCreateInstance(o,t)})}static getInstance(e){return d.has(e)?d.get(e):null}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,t)}dispose(){u--,this._searchInput.removeEventListener("focus",this),this._searchInput.removeEventListener("blur",this),this._searchInput.removeEventListener("input",this),this._searchInput.removeEventListener("keydown",this),this._dropElement.removeEventListener("mousemove",this),this._config.fixed&&u<=0&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this._dropElement.parentElement.removeChild(this._dropElement),d.delete(this._searchInput)}handleEvent(e){this[`on${e.type}`](e)}_configure(e={}){this._config=Object.assign({},L);let t={...e,...this._searchInput.dataset},s=o=>["true","false","1","0",!0,!1].includes(o)&&!!JSON.parse(o);for(let[o,n]of Object.entries(L)){if(t[o]===void 0)continue;let i=t[o];switch(typeof n){case"number":this._config[o]=parseInt(i);break;case"boolean":this._config[o]=s(i);break;case"string":this._config[o]=i.toString();break;case"object":if(Array.isArray(n))if(typeof i=="string"){let a=i.includes("|")?"|":",";this._config[o]=i.split(a)}else this._config[o]=i;else this._config[o]=typeof i=="string"?JSON.parse(i):i;break;case"function":this._config[o]=typeof i=="string"?window[i]:i;break;default:this._config[o]=i;break}}}_configureSearchInput(){this._searchInput.autocomplete="off",this._searchInput.spellcheck=!1,this._searchInput.ariaAutoComplete="list",this._searchInput.ariaExpanded="false",this._searchInput.ariaHasPopup="menu",this._searchInput.setAttribute("role","combobox"),this._hiddenInput=null,this._config.hiddenInput&&(this._hiddenInput=document.createElement("input"),this._hiddenInput.type="hidden",this._hiddenInput.value=this._config.hiddenValue,this._hiddenInput.name=this._searchInput.name,this._searchInput.name="_"+this._searchInput.name,k(this._searchInput,this._hiddenInput))}_configureDropElement(){this._dropElement=document.createElement("ul"),this._dropElement.setAttribute("id","ac-menu-"+u),this._dropElement.setAttribute("role","menu"),this._dropElement.classList.add("dropdown-menu","autocomplete-menu","p-0"),this._dropElement.style.maxHeight="280px",this._config.fullWidth||(this._dropElement.style.maxWidth="360px"),this._config.fixed&&(this._dropElement.style.position="fixed"),this._dropElement.style.overflowY="auto",this._dropElement.style.overscrollBehavior="contain",this._dropElement.style.textAlign="unset",k(this._searchInput,this._dropElement),this._searchInput.setAttribute("aria-controls",this._dropElement.getAttribute("id"))}oninput(e){this._preventInput||(this._hiddenInput&&(this._hiddenInput.value=null),this.showOrSearch())}onblur(e){this.hideSuggestions()}onfocus(e){this.showOrSearch()}onkeydown(e){switch(e.keyCode||e.key){case 13:case"Enter":if(this.isDropdownVisible()){e.preventDefault();let s=this.getSelection();s&&s.click()}break;case 38:case"ArrowUp":e.preventDefault(),this._keyboardNavigation=!0,this._moveSelection(C);break;case 40:case"ArrowDown":e.preventDefault(),this._keyboardNavigation=!0,this.isDropdownVisible()?this._moveSelection(c):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this._searchInput.focus(),this.hideSuggestions());break}}onmousemove(e){this._keyboardNavigation=!1}onscroll(e){this._positionMenu()}onresize(e){this._positionMenu()}getConfig(e=null){return e!==null?this._config[e]:this._config}setConfig(e,t){this._config[e]=t}setData(e){this._items={},this._addItems(e)}enable(){this._searchInput.setAttribute("disabled","")}disable(){this._searchInput.removeAttribute("disabled")}isDisabled(){return this._searchInput.hasAttribute("disabled")||this._searchInput.disabled||this._searchInput.hasAttribute("readonly")}isDropdownVisible(){return this._dropElement.classList.contains(l)}getSelection(){return this._dropElement.querySelector("a."+A)}removeSelection(){let e=this.getSelection();e&&e.classList.remove(...this._activeClasses())}_activeClasses(){return[...this._config.activeClasses,A]}_moveSelection(e=c){let t=this.getSelection(),s=null;if(!t)s=this._dropElement.firstChild;else{let o=e===c?"nextSibling":"previousSibling";s=t.parentNode;do s=s[o];while(s&&s.style.display=="none");s?(t.classList.remove(...this._activeClasses()),e===C?s.parentNode.scrollTop=s.offsetTop-s.parentNode.offsetTop:s.offsetTop>s.parentNode.offsetHeight-s.offsetHeight&&(s.parentNode.scrollTop+=s.offsetHeight)):t&&(s=t.parentElement)}if(s){let o=s.querySelector("a");o.classList.add(...this._activeClasses()),this._searchInput.setAttribute("aria-activedescendant",o.getAttribute("id")),this._config.updateOnSelect&&(this._searchInput.value=o.dataset.label)}else this._searchInput.setAttribute("aria-activedescendant","");return s}_shouldShow(){return this.isDisabled()?!1:this._searchInput.value.length>=this._config.suggestionsThreshold}showOrSearch(e=!0){if(e&&!this._shouldShow()){this.hideSuggestions();return}this._config.liveServer?this._searchFunc():this._config.source?this._config.source(this._searchInput.value,t=>{this.setData(t),this._showSuggestions()}):this._showSuggestions()}_createItem(e,t){let s=t.label;if(this._config.highlightTyped){let i=_(s).toLowerCase().indexOf(e);s=s.substring(0,i)+`<mark>${s.substring(i,i+e.length)}</mark>`+s.substring(i+e.length,s.length)}s=this._config.onRenderItem(t,s,this);let o=document.createElement("li");o.setAttribute("role","presentation");let n=document.createElement("a");if(o.append(n),n.setAttribute("id",this._dropElement.getAttribute("id")+"-"+this._dropElement.children.length),n.classList.add("dropdown-item","text-truncate"),n.setAttribute("data-value",t.value),n.setAttribute("data-label",t.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=s,t.data)for(let[i,a]of Object.entries(t.data))n.dataset[i]=a;return n.addEventListener("mouseenter",i=>{this._keyboardNavigation||(this.removeSelection(),o.querySelector("a").classList.add(...this._activeClasses()))}),n.addEventListener("mousedown",i=>{i.preventDefault()}),n.addEventListener("click",i=>{i.preventDefault(),this._preventInput=!0,this._searchInput.value=t.label,this._hiddenInput&&(this._hiddenInput.value=t.value),this._config.onSelectItem(t,this),this.hideSuggestions(),this._preventInput=!1}),o}_showSuggestions(){let e=_(this._searchInput.value).toLowerCase();this._dropElement.innerHTML="";let t=Object.keys(this._items),s=0,o=null;for(let n=0;n<t.length;n++){let i=t[n],a=this._items[i],h=_(a.label).toLowerCase(),S=e.length>0?h.indexOf(e)>=0:!0;if(this._config.showAllSuggestions||S){s++;let w=this._createItem(e,a);if(o||(o=w),this._dropElement.appendChild(w),this._config.maximumItems>0&&s>=this._config.maximumItems)break}}if(o&&this._config.autoselectFirst&&this._moveSelection(c),s===0)if(this._config.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this._config.notFoundMessage}</span>`,this._dropElement.appendChild(n),this._showDropdown()}else this.hideSuggestions();else this._showDropdown()}_showDropdown(){this._dropElement.classList.add(l),this._searchInput.ariaExpanded="true",this._positionMenu()}toggleSuggestions(e=!0){this._dropElement.classList.contains(l)?this.hideSuggestions():this.showOrSearch(e)}hideSuggestions(){this._dropElement.classList.remove(l),this._searchInput.ariaExpanded="false",this.removeSelection()}getInput(){return this._searchInput}getDropMenu(){return this._dropElement}_hasFixedParent(){let e=this._searchInput.parentElement;for(;e&&e instanceof HTMLElement;){if(e.style.position==="fixed")return!0;e=e.parentElement}return!1}_positionMenu(){let e=window.getComputedStyle(this._searchInput),t=this._searchInput.getBoundingClientRect(),s=this._hasFixedParent(),o=e.direction==="rtl",n=null,i=null;this._config.fixed&&(n=t.x,i=t.y+t.height,o&&!this._config.fullWidth&&(n-=this._dropElement.offsetWidth-t.width)),this._dropElement.style.transform="unset",this._config.fullWidth&&(this._dropElement.style.width=this._searchInput.offsetWidth+"px"),n!==null&&(this._dropElement.style.left=n+"px"),i!==null&&(this._dropElement.style.top=i+"px");let a=this._dropElement.getBoundingClientRect(),h=s?window.innerHeight:document.body.offsetHeight;h-1-(a.y+a.height)<0&&t.y>h/2&&(this._dropElement.style.transform="translateY(calc(-100% - "+this._searchInput.offsetHeight+"px))")}_fetchData(){this._items={},this._addItems(this._config.items);let e=this._config.datalist;if(e){let t=document.querySelector(`#${e}`);if(t){let s=Array.from(t.children).map(o=>{let n=o.getAttribute("value")??o.innerHTML.toLowerCase(),i=o.innerHTML;return{value:n,label:i}});this._addItems(s)}else console.error(`Datalist not found ${e}`)}this._setHiddenVal(),this._config.server&&!this._config.liveServer&&this._loadFromServer()}_setHiddenVal(){if(this._config.hiddenInput&&!this._config.hiddenValue)for(let[e,t]of Object.entries(this._items))t.label==this._searchInput.value&&(this._hiddenInput.value=e)}_addItems(e){let t=Object.keys(e);for(let s=0;s<t.length;s++){let o=t[s],n=e[o],i=typeof n=="string"?n:n.label,a=typeof n=="string"?{}:n;a.label=n[this._config.labelField]??i,a.value=n[this._config.valueField]??o,this._items[a.value]=a}}_loadFromServer(e=!1){this._abortController&&this._abortController.abort(),this._abortController=new AbortController;let t=Object.assign({},this._config.serverParams);if(t[this._config.queryParam]=this._searchInput.value,this._config.noCache&&(t.t=Date.now()),t.related){let i=document.getElementById(t.related);i&&(t.related=i.value)}let s=new URLSearchParams(t),o=this._config.server,n=Object.assign(this._config.fetchOptions,{method:this._config.serverMethod||"GET",signal:this._abortController.signal});n.method==="POST"?n.body=s:o+="?"+s.toString(),this._searchInput.classList.add(x),fetch(o,n).then(i=>this._config.onServerResponse(i,this)).then(i=>{let a=i.data||i;this.setData(a),this._setHiddenVal(),this._abortController=null,e&&this._showSuggestions()}).catch(i=>{i.name!=="AbortError"&&console.error(i)}).finally(i=>{this._searchInput.classList.remove(x)})}},T=m;function f(r){for(let[e,t]of Object.entries(r))if(t&&typeof t=="object"){let s=t.__fn;s?typeof s=="string"?r[e]=s.split(".").reduce((o,n)=>o[n],window):Array.isArray(s)&&(r[e]=new Function(s[0],s[1])):f(t)}return r}function p(r){let e=r;do{if(e.nextSibling){r.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{p(r)})}var g,v=class extends HTMLElement{connectedCallback(){g&&clearTimeout(g),p(this)}disconnectedCallback(){this.disconnected(),g=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=f(JSON.parse(this.dataset.config||"{}")),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},O=v;function b(r,e){e=typeof e=="string"?[e]:e,e.forEach(t=>{r.querySelectorAll(t).forEach(s=>{s.remove()})})}var I=class extends O{get el(){return this.querySelector("input")}created(){b(this,"div.dropdown"),this.config=Object.assign({hiddenInput:!0},this.config),this.lib=new T(this.el,this.config)}destroyed(){this.lib.dispose(),this.lib=null}},E=I;var D=customElements;function y(r,e){D.get(r)||D.define(r,e)}y("bs-autocomplete",E);var U=E;})();
