(function(e){"use strict";function t(e){f--,o(f+" remaining scripts"),f<=0&&(f=0,o("all scripts loaded"),l&&(l=!1,m.run()))}function i(e){if(!e.hasAttribute("async")&&!e.hasAttribute("nomodule")&&e.hasAttribute("src")){l=!0,o("tracking "+e.getAttribute("href")),f++;var i=e.onload,n=e.onerror;e.onload=function(n){i&&i(n),t(e)},e.onerror=function(i){n&&n(i),t(e)}}}function n(e,t,i){var n;return i?n=e[i].apply(a,t):(n=Object.create(e.prototype),e.apply(n,t)),n}function r(e){"complete"===a.readyState||"loading"!==a.readyState&&!a.documentElement.doScroll?e():a.addEventListener("DOMContentLoaded",e)}function o(e){u.debug&&console.log("[mb] "+e)}function s(){return c++,"ModularBehaviour"+c.toString()}"undefined"==typeof jQuery&&"undefined"!=typeof require&&require.defined&&require.defined("jquery")&&(jQuery=require("jquery")),e||(e=window);var a=e.document,u={attr:"data-mb",failedClass:"mb-failed",initClass:"mb-init",optionsKey:"options",maxTries:3,retryInterval:250,domRunInterval:500,observeDom:!0,runAfterDomChanges:!0,debug:!1},d={},f=0,l=!1,c=0,m={optionsTransformers:{},afterInitHooks:{},domObserver:null,initialized:!1,init:function(e){if(!this.initialized){var t=this;if(e)for(var i in e)this.setConfig(i,e[i]);f&&o(f+" scripts loading"),r(function(){t.run(),u.observeDom&&t.startObserver()}),this.initialized=!0}},startObserver:function(){var e=this,t=null;if(!e.domObserver){var n=[];e.domObserver=new MutationObserver(function(r){for(var o=0;o<r.length;o++){var s=r[o];if(!s.target.classList.contains("search-form__wrapper"))for(var a=0;a<s.addedNodes.length;a++){var d=s.addedNodes[a];d.tagName&&!1!==d.isConnected&&("script"===d.tagName.toLowerCase()&&i(d),l||d.hasAttribute(u.attr)&&(n.push(d),e.configureElement(d)))}}l||u.runAfterDomChanges&&(t&&clearTimeout(t),t=setTimeout(function(){e.run()},u.domRunInterval))});var r=a.documentElement||a.body;e.domObserver.observe(r,{subtree:!0,attributes:!1,childList:!0,characterData:!1}),o("Observing dom")}},stopObserver:function(){this.domObserver&&(this.domObserver.disconnect(),this.domObserver=null)},getConfig:function(e){return u[e]},setConfig:function(e,t){u[e]=t},run:function(){var e=this;if(f)return o("should run"),l=!0,void setTimeout(function(){f&&(f=0,e.run(),o("run anyway"))},500);var t=a.querySelectorAll("["+u.attr+"]:not(."+u.initClass+")");o("run : "+t.length+" modules to configure");for(var i=0;i<t.length;i++)this.configureElement(t[i]);l=!1},addAfterInitHook:function(e,t){this.afterInitHooks[e]=t},removeAfterInitHook:function(e){delete this.afterInitHooks[e]},addOptionsTransformer:function(e,t){this.optionsTransformers[e]=t},removeOptionsTransformer:function(e){delete this.optionsTransformers[e]},parseOptions:function(t){if(!t||"undefined"===t)return{};if("string"==typeof t)if(0===t.indexOf("base64:")&&(t=atob(t.substring(7))),"#"===t.charAt(0)){var i=a.getElementById(t.substring(1));i&&"template"===i.tagName.toLowerCase()&&(i=i.content);var n=i&&i.textContent;n?t=JSON.parse(n):o("Config not found with selector "+t)}else if("()"===t.slice(-2)){var r=t.substring(0,t.length-2);r in e?t=e[r]():o("Config callback not found with name "+r)}else"{"===t.charAt(0)?(t=JSON.parse(t),t||o("Invalid config. Make sure it's properly JSON encoded.")):o("Weird config detected",t);return t},configureModule:function(t,i,r){var s,a=this,f=e,l=i,c=null;if(-1!==i.indexOf(".")){var m=i.split(".");f=e[m[0]],l=m[1]}if(-1!==l.indexOf(":")){var g=l.split(":");l=g[0],c=g[1]}try{f&&void 0!==f[l]?(o("Configuring js module "+i),s=n(f[l],[t,r],c)):"undefined"!=typeof jQuery&&void 0!==jQuery.fn[l]?(o("Configuring jQuery module "+i),s=jQuery.fn[l].call(jQuery(t),r)):(o("Undefined module "+i),t.classList.add(u.failedClass))}catch(e){t.parentNode.innerText=e,t.classList.add(u.initClass),s=null,d[t.getAttribute("id")]=u.maxTries}if(s)t.classList.remove(u.failedClass),t.classList.add(u.initClass),i in this.afterInitHooks&&this.afterInitHooks[i](s,t,r),o(i+" initialized");else{var v=d[t.getAttribute("id")]||0;v<u.maxTries&&(v++,d[t.getAttribute("id")]=v,e.setTimeout(function(){o("try again for "+i),a.configureModule(t,i,r)},u.retryInterval))}},configureElement:function(e){if(e.classList.contains(u.initClass))o(e.getAttribute("id")+" is already initialized");else{e.getAttribute("id")||(o("an id has been set for an element"),e.setAttribute("id",s()));for(var t=e.getAttribute(u.attr).split(" "),i=0;i<t.length;i++){var n=t[i],r=e.getAttribute(u.attr+"-"+n+"-"+u.optionsKey);if(r||(r=e.getAttribute(u.attr+"-"+u.optionsKey)),r=this.parseOptions(r),n in this.optionsTransformers){o("Using option transformer for "+n);var a=this.optionsTransformers[n](r,e);a&&(r=a)}this.configureModule(e,n,r)}}}};"function"==typeof define&&define.amd?define(function(){return m}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports.ModularBehaviour=m):e.ModularBehaviour=m})(this);