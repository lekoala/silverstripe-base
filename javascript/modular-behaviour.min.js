(function(e,t){"use strict";function i(e,t){var i=Object.create(e.prototype);return e.apply(i,t),i}function n(e){"complete"===s.readyState||"loading"!==s.readyState&&!s.documentElement.doScroll?e():s.addEventListener("DOMContentLoaded",e)}function r(e){a.debug&&console.log("[mb] "+e)}function o(){return f++,"ModularBehaviour"+f.toString()}!t&&require&&require.defined&&require.defined("jquery")&&(t=require("jquery"));var s=e.document,a={attr:"data-mb",failedClass:"mb-failed",initClass:"mb-init",optionsKey:"options",maxTries:5,retryInterval:250,debug:!1},f=0,u={optionsTransformers:{},afterInitHooks:{},init:function(e){var t=this;if(e)for(var i in e)this.setConfig(i,e[i]);n(function(){t.run()})},getConfig:function(e){return a[e]},setConfig:function(e,t){a[e]=t},load:function(){var t=this;e.addEventListener("load",function(){t.run()})},run:function(){r("run");for(var e=s.querySelectorAll("["+a.attr+"]"),t=0;t<e.length;t++)this.configureElement(e[t])},addAfterInitHook:function(e,t){this.afterInitHooks[e]=t},removeAfterInitHook:function(e){delete this.afterInitHooks[e]},addOptionsTransformer:function(e,t){this.optionsTransformers[e]=t},removeOptionsTransformer:function(e){delete this.optionsTransformers[e]},parseOptions:function(t){if(!t||"undefined"===t)return{};if("string"==typeof t)if("#"===t.charAt(0)){var i=s.getElementById(t.slice(1));if(i){var n=i.textContent;t=JSON.parse(n)}else r("Config not found with id "+t)}else if("()"===t.slice(-2)){var o=t.substring(0,t.length-2);o in e?t=e[o]():r("Config callback not found with name "+o)}else"{"===t.charAt(0)?(t=JSON.parse(t),t||r("Invalid config. Make sure it's properly JSON encoded.")):r("Weird config detected",t);return t},configureModule:function(n,o,s){var f,u,d=this;if(-1!==o.indexOf(".")){var l=o.split(".");u=l[0]}if(u&&void 0!==e[u]?(r("Configuring namespaced js module "+o),f=i(e[u][l[1]],["#"+n.getAttribute("id"),s])):u||void 0===e[o]?t&&void 0!==t.fn[o]?(r("Configuring jQuery module "+o),f=t.fn[o].call(t(n),s)):(r("Undefined module "+o),n.classList.add(a.failedClass)):(r("Configuring js module "+o+" on #"+n.getAttribute("id")),f=i(e[o],["#"+n.getAttribute("id"),s])),f)n.classList.remove(a.failedClass),n.classList.add(a.initClass),o in this.afterInitHooks&&this.afterInitHooks[o](f,n,s),r(o+" initialized");else{var c=n.getAttribute(a.attr+"-retries");c||(c=0),c<a.maxTries&&(c++,n.setAttribute(a.attr+"-retries",c),e.setTimeout(function(){r("try again for "+o),d.configureModule(n,o,s)},a.retryInterval))}},configureElement:function(e){if(e.classList.contains(a.initClass))r("already initialized");else{e.getAttribute("id")||(r("an id has been set for an element"),e.setAttribute("id",o()));for(var t=e.getAttribute(a.attr).split(" "),i=0;i<t.length;i++){var n=t[i],s=e.getAttribute(a.attr+"-"+n+"-"+a.optionsKey);if(s||(s=e.getAttribute(a.attr+"-"+a.optionsKey)),s=this.parseOptions(s),n in this.optionsTransformers){var f=this.optionsTransformers[n](s,e);f&&(s=f)}this.configureModule(e,n,s)}}}};"function"==typeof define&&define.amd?define(function(){return u}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.ModularBehaviour=u):e.ModularBehaviour=u})(this,jQuery);