(function(t,e){"use strict";function i(t,e){var i=Object.create(t.prototype);return t.apply(i,e),i}function n(t){"complete"===s.readyState||"loading"!==s.readyState&&!s.documentElement.doScroll?t():s.addEventListener("DOMContentLoaded",t)}function r(t){a.debug&&console.log("[mb] "+t)}function o(){return f++,"ModularBehaviour"+f.toString()}!e&&require&&require.defined&&require.defined("jquery")&&(e=require("jquery"));var s=t.document,a={attr:"data-mb",failedClass:"mb-failed",initClass:"mb-init",optionsKey:"options",maxTries:5,retryInterval:250,debug:!0},f=0,u={optionsTransformers:{},afterInitHooks:{},init:function(t){var e=this;if(t)for(var i in t)this.setConfig(t[i]);n(function(){e.run()})},getConfig:function(t){return a[t]},setConfig:function(t,e){a[t]=e},load:function(){var e=this;t.addEventListener("load",function(){e.run()})},run:function(){r("run");for(var t=s.querySelectorAll("["+a.attr+"]"),e=0;e<t.length;e++)this.configureElement(t[e])},addAfterInitHook:function(t,e){this.afterInitHooks[t]=e},removeAfterInitHook:function(t){delete this.afterInitHooks[t]},addOptionsTransformer:function(t,e){this.optionsTransformers[t]=e},removeOptionsTransformer:function(t){delete this.optionsTransformers[t]},parseOptions:function(e){if(!e)return{};if("string"==typeof e)if("#"===e.charAt(0)){var i=s.getElementById(e),n=i.textContent;n?e=JSON.parse(n):r("Config not found with id "+e)}else if("()"===e.slice(-2)){var o=e.substring(0,e.length-2);o in t?e=t[o]():r("Config callback not found with name "+o)}else"{"===e.charAt(0)?r("Invalid config. Make sure it's properly JSON encoded."):r("Weird config detected",e);return e},configureModule:function(n,o,s){var f,u,d=this;if(-1!==o.indexOf(".")){var l=o.split(".");u=l[0]}if(u&&void 0!==t[u]?(r("Configuring namespaced js module "+o),f=i(t[u][l[1]],["#"+n.getAttribute("id"),s])):u||void 0===t[o]?e&&void 0!==e.fn[o]?(r("Configuring jQuery module "+o),f=e.fn[o].call(e(n),s)):(r("Undefined module "+o),n.classList.add(a.failedClass)):(r("Configuring js module "+o),f=i(t[o],["#"+n.getAttribute("id"),s])),f)n.classList.remove(a.failedClass),n.classList.add(a.initClass),o in this.afterInitHooks&&this.afterInitHooks[o](f,n,s),r(o+" initialized");else{var c=n.getAttribute(a.attr+"-retries");c||(c=0),c<a.maxTries&&(c++,n.setAttribute(a.attr+"-retries",c),t.setTimeout(function(){r("try again for "+o),d.configureModule(n,o,s)},a.retryInterval))}},configureElement:function(t){if(t.classList.contains(a.initClass))r("already initialized");else{t.getAttribute("id")||(r("an id has been set for an element"),t.setAttribute("id",o()));for(var e=t.getAttribute(a.attr).split(" "),i=0;i<e.length;i++){var n=e[i],s=t.getAttribute(a.attr+"-"+n+"-"+a.optionsKey);if(s||(s=t.getAttribute(a.attr+"-"+a.optionsKey)),s=this.parseOptions(s),n in this.optionsTransformers){var f=this.optionsTransformers[n](s,t);f&&(s=f)}this.configureModule(t,n,s)}}}};"function"==typeof define&&define.amd?define(function(){return u}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.ModularBehaviour=u):t.ModularBehaviour=u})(this,jQuery);