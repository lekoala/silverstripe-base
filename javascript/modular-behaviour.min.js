(function(e){"use strict";function t(e,t){if(!e.hasAttribute("async")&&!e.hasAttribute("nomodule")){n("tracking "+e.getAttribute("href")),d++;var i=e.onload;e.onload=function(e){i&&i(e),d--,n(d+" remaining scripts"),d<=0&&(d=0,n("all scripts loaded"),f&&c.run())}}}function i(e,t,i){var r;return i?r=e[i].apply(s,t):(r=Object.create(e.prototype),e.apply(r,t)),r}function r(e){"complete"===s.readyState||"loading"!==s.readyState&&!s.documentElement.doScroll?e():s.addEventListener("DOMContentLoaded",e)}function n(e){a.debug&&console.log("[mb] "+e)}function o(){return l++,"ModularBehaviour"+l.toString()}"undefined"==typeof jQuery&&"undefined"!=typeof require&&require.defined&&require.defined("jquery")&&(jQuery=require("jquery"));var s=e.document,a={attr:"data-mb",failedClass:"mb-failed",initClass:"mb-init",optionsKey:"options",maxTries:3,retryInterval:250,observeDom:!0,runAfterDomChanges:!0,debug:!1},u={},d=0,f=!1,l=0,c={optionsTransformers:{},afterInitHooks:{},domObserver:null,initialized:!1,init:function(e){if(!this.initialized){var t=this;if(e)for(var i in e)this.setConfig(i,e[i]);d&&n(d+" scripts loading"),r(function(){t.run(),a.observeDom&&t.startObserver()}),this.initialized=!0}},startObserver:function(){var e=this,i=null;if(!e.domObserver){e.domObserver=new MutationObserver(function(r){for(var n=0;n<r.length;n++){var o=r[n];if(o.target.classList.contains("search-form__wrapper"))return;for(var s=0;s<o.addedNodes.length;s++){var u=o.addedNodes[s];if(!u.tagName||!1===u.isConnected)return;"script"===u.tagName.toLowerCase()&&(t(u),f=!0),f||(u.hasAttribute(a.attr)&&e.configureElement(u),a.runAfterDomChanges&&(i&&clearTimeout(i),i=setTimeout(function(){e.run()},100)))}}});var r=s.documentElement||s.body;e.domObserver.observe(r,{subtree:!0,attributes:!1,childList:!0,characterData:!1}),n("Observing dom")}},stopObserver:function(){this.domObserver&&this.domObserver.disconnect()},getConfig:function(e){return a[e]},setConfig:function(e,t){a[e]=t},run:function(){var e=this;if(d)return n("should run"),f=!0,void setTimeout(function(){d&&(d=0,e.run(),n("run anyway"))},500);var t=s.querySelectorAll("["+a.attr+"]:not(."+a.initClass+")");n("run : "+t.length+" modules to configure");for(var i=0;i<t.length;i++)this.configureElement(t[i]);f=!1},addAfterInitHook:function(e,t){this.afterInitHooks[e]=t},removeAfterInitHook:function(e){delete this.afterInitHooks[e]},addOptionsTransformer:function(e,t){this.optionsTransformers[e]=t},removeOptionsTransformer:function(e){delete this.optionsTransformers[e]},parseOptions:function(t){if(!t||"undefined"===t)return{};if("string"==typeof t)if(0===t.indexOf("base64:")&&(t=atob(t.substring(7))),"#"===t.charAt(0)){var i=s.getElementById(t.substring(1));i&&"template"===i.tagName.toLowerCase()&&(i=i.content);var r=i&&i.textContent;r?t=JSON.parse(r):n("Config not found with selector "+t)}else if("()"===t.slice(-2)){var o=t.substring(0,t.length-2);o in e?t=e[o]():n("Config callback not found with name "+o)}else"{"===t.charAt(0)?(t=JSON.parse(t),t||n("Invalid config. Make sure it's properly JSON encoded.")):n("Weird config detected",t);return t},configureModule:function(t,r,o){var s,d=this,f=e,l=r,c=null;if(-1!==r.indexOf(".")){var m=r.split(".");f=e[m[0]],l=m[1]}if(-1!==l.indexOf(":")){var g=l.split(":");l=g[0],c=g[1]}try{f&&void 0!==f[l]?(n("Configuring js module "+r),s=i(f[l],[t,o],c)):"undefined"!=typeof jQuery&&void 0!==jQuery.fn[l]?(n("Configuring jQuery module "+r),s=jQuery.fn[l].call(jQuery(t),o)):(n("Undefined module "+r),t.classList.add(a.failedClass))}catch(e){t.parentNode.innerText=e,t.classList.add(a.initClass),s=null,u[t.getAttribute("id")]=a.maxTries}if(s)t.classList.remove(a.failedClass),t.classList.add(a.initClass),r in this.afterInitHooks&&this.afterInitHooks[r](s,t,o),n(r+" initialized");else{var p=u[t.getAttribute("id")]||0;p<a.maxTries&&(p++,u[t.getAttribute("id")]=p,e.setTimeout(function(){n("try again for "+r),d.configureModule(t,r,o)},a.retryInterval))}},configureElement:function(e){if(e.classList.contains(a.initClass))n(e.getAttribute("id")+" is already initialized");else{e.getAttribute("id")||(n("an id has been set for an element"),e.setAttribute("id",o()));for(var t=e.getAttribute(a.attr).split(" "),i=0;i<t.length;i++){var r=t[i],s=e.getAttribute(a.attr+"-"+r+"-"+a.optionsKey);if(s||(s=e.getAttribute(a.attr+"-"+a.optionsKey)),s=this.parseOptions(s),r in this.optionsTransformers){n("Using option transformer for "+r);var u=this.optionsTransformers[r](s,e);u&&(s=u)}this.configureModule(e,r,s)}}}};"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.ModularBehaviour=c):e.ModularBehaviour=c})(this);